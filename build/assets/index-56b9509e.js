(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll("link[rel=\"modulepreload\"]"))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o);}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n;}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n);}})();const Ht=class Ht{constructor(t,e){this.variant=t,this.spriteLoader=e,this.base=this.loadSprite("base"),this.hover=this.loadSprite("hover");}loadSprite(t){return this.spriteLoader.loadImagePNG(Ht.PATH,this.variant,t);}static DefaultButton(t){return new Ht("default",t);}static OutstandingButton(t){return new Ht("outstanding",t);}};Ht.PATH="ui/buttons";let Ne=Ht;const ze=class ze{constructor(t){this.spriteLoader=t,this.base=this.loadSprite("base"),this.active=this.loadSprite("active");}loadSprite(t){return this.spriteLoader.loadImagePNG(ze.PATH,t);}};ze.PATH="ui/edit_icon";let Es=ze;const Ue=class Ue{static Explosion(t){return t.loadImageListInPNG(Ue.EXPLOSION_FRAMES_LENGTH,"effects/explosion");}};Ue.EXPLOSION_FRAMES_LENGTH=10;let ms=Ue;const k=class k{constructor(t,e){this.moving=e.loadImageListInPNG(k.MOVING_FRAMES,k.PATH,t),this.fire=e.loadImagePNG(k.PATH,t,"fire");}static WeakEnemy(t){return new k("enemy_weak",t);}static RegularEnemy(t){return new k("enemy_regular",t);}static StrongEnemy(t){return new k("enemy_strong",t);}static EnemyLaser(t){return t.loadImagePNG(k.PATH,"laser");}};k.MOVING_FRAMES=3,k.PATH="enemies";let xt=k;var Ae=(i=>(i.Spanish="es",i.English="en",i.Portuguese="pt",i.French="fr",i))(Ae||{});const Zt=Object.values(Ae),Ke=class Ke{constructor(t){this.spriteLoader=t,this.flags=new Map;const e=this.spriteLoader.loadImageListInPNGFromSource(Zt,Ke.PATH);Zt.forEach((s,r)=>{this.flags.set(s,e[r]);});}getFlag(t){return this.flags.get(t);}getQuantityFlags(){return this.flags.size;}};Ke.PATH="languageflag";let Is=Ke;const At=class At{constructor(t,e,s){this.variant=t,this.size=e,this.spriteLoader=s,this.base=this.loadSprite("base"),this.hover=this.loadSprite("hover");}loadSprite(t){return this.spriteLoader.loadImagePNG(At.PATH,this.variant,this.size,t);}static DefaultKey(t){return new At("default","small",t);}static OutstandingKey(t){return new At("outstanding","small",t);}static OutstandingLargeKey(t){return new At("outstanding","large",t);}};At.PATH="ui/keyboard_input_keys";let ee=At;const Ze=class Ze{constructor(t){this.spriteLoader=t,this.large=this.loadSprite("large"),this.small=this.loadSprite("small");}loadSprite(t){return this.spriteLoader.loadImagePNG(Ze.PATH,t);}};Ze.PATH="ui/keys";let Ss=Ze;const Xe=class Xe{constructor(t){this.spriteLoader=t,this.first=this.loadSprite("first"),this.second=this.loadSprite("second"),this.third=this.loadSprite("third");}loadSprite(t){return this.spriteLoader.loadImagePNG(Xe.PATH,t);}};Xe.PATH="scoremedals";let fs=Xe;const kt=class kt{constructor(t,e){this.variant=t,this.spriteLoader=e,this.arrow=this.loadSprite(this.variant);}loadSprite(t){return this.spriteLoader.loadImagePNG(kt.PATH,t);}static Right(t){return new kt("arrow_right",t);}static Left(t){return new kt("arrow_left",t);}};kt.PATH="arrow";let Re=kt;const je=class je{constructor(t){this.spriteLoader=t,this.noDamage=this.loadSprite("no_damage"),this.damaged=this.loadSprite("damaged"),this.veryDamaged=this.loadSprite("very_damaged");}loadSprite(t){return this.spriteLoader.loadImagePNG(je.PATH,t);}};je.PATH="shield";let Ts=je;const et=class et{constructor(t,e){const s=e.loadImageListInPNG(et.MOVING_FRAMES,et.PATH,t);this.idle=[s[0],s[1]],this.moving=[s[1],s[2]],this.laser=e.loadImagePNG(et.PATH,t,"laser");}static ShipOne(t){return new et("ship_one",t);}static ShipTwo(t){return new et("ship_two",t);}};et.MOVING_FRAMES=3,et.PATH="ships";let ve=et;const ne=class ne{constructor(t){this.spriteLoader=t,this.base=this.loadSprite("base"),this.hover=this.loadSprite("hover");}loadSprite(t){return this.spriteLoader.loadImagePNG(ne.PATH,t);}static SplashLogo(t){return new ne(t);}};ne.PATH="ui/splash_logo";let ws=ne;function ds(i){return`/invasores_p_web_sandbox/${i}`;}const $e=class $e{getSpritePath(...t){return`${$e.SPRITES_ROOT}/${t.join("/")}`;}loadImage(t){const e=new Image;return e.src=t,e;}loadImagePNG(...t){return this.loadImage(`${this.getSpritePath(...t)}.png`);}loadImageListInPNG(t,...e){const s=Array(t);for(let r=0;r<s.length;r++)s[r]=this.loadImagePNG(...e,r.toString());return s;}loadImageListInPNGFromSource(t,...e){const s=Array(t.length);for(let r=0;r<s.length;r++)s[r]=this.loadImagePNG(...e,t[r]);return s;}};$e.SPRITES_ROOT=ds("sprites");let Os=$e;const Pt=class Pt{static Title(t){return t.loadImagePNG("ui/title");}static WebEditionTag(t){return t.loadImagePNG("ui/web_edition_tag");}static Pause(t){return t.loadImagePNG("ui/pause");}static GameOver(t){return t.loadImagePNG("ui/game_over");}static VolumeIcon(t){return t.loadImageListInPNG(Pt.VOLUME_ICON_QUANTITY,"ui/volume_icon");}static NPCShipOne(t){return t.loadImageListInPNG(Pt.MODE_BUTTON_SHIP_QUANTITY,"ui/npcs/ship_one");}static NPCShipTwo(t){return t.loadImageListInPNG(Pt.MODE_BUTTON_SHIP_QUANTITY,"ui/npcs/ship_two");}static PlayerSelector(t){return t.loadImagePNG("ui/player_selector");}};Pt.MODE_BUTTON_SHIP_QUANTITY=3,Pt.VOLUME_ICON_QUANTITY=4;let Z=Pt;class ei{constructor(){const t=new Os;this.SPLASH_LOGO=ws.SplashLogo(t),this.SHIP_ONE=ve.ShipOne(t),this.SHIP_TWO=ve.ShipTwo(t),this.PLAYER_SELECTOR=Z.PlayerSelector(t),this.WEAK_ENEMY=xt.WeakEnemy(t),this.REGULAR_ENEMY=xt.RegularEnemy(t),this.STRONG_ENEMY=xt.StrongEnemy(t),this.ENEMY_LASER=xt.EnemyLaser(t),this.SHIELD=new Ts(t),this.EXPLOSION=ms.Explosion(t),this.TITLE=Z.Title(t),this.WEB_EDITION_TAG=Z.WebEditionTag(t),this.PAUSE=Z.Pause(t),this.GAME_OVER=Z.GameOver(t),this.DEFAULT_BUTTON_SPRITES=Ne.DefaultButton(t),this.OUTSTANDING_BUTTON_SPRITES=Ne.OutstandingButton(t),this.KEY_SPRITES=new Ss(t),this.NPC_SHIP_ONE=Z.NPCShipOne(t),this.NPC_SHIP_TWO=Z.NPCShipTwo(t),this.SCORE_MEDALS=new fs(t),this.EDIT_ICON=new Es(t),this.KEYBOARD_INPUT_KEY_DEFAULT=ee.DefaultKey(t),this.KEYBOARD_INPUT_KEY_OUTSTANDING=ee.OutstandingKey(t),this.KEYBOARD_INPUT_KEY_OUTSTANDING_LARGE=ee.OutstandingLargeKey(t),this.LEFT_ARROW=Re.Left(t),this.RIGHT_ARROW=Re.Right(t),this.FLAGS=new Is(t),this.VOLUME_ICON=Z.VolumeIcon(t);}static async create(){const t=new ei;return await Promise.all(t.getAllImages().map(e=>new Promise(s=>{e.addEventListener("load",()=>s());}))),t;}getAllImages(){return Object.values(this).map(e=>e instanceof HTMLImageElement?e:typeof e=="object"&&!Array.isArray(e)?Object.values(e):e).flat(1/0).filter(e=>e instanceof HTMLImageElement);}}class c{static async init(){c._spriteManager=await ei.create();}static get spriteManager(){return c._spriteManager;}}class a{constructor(t,e){this.x=t,this.y=e;}static Horizontal(t){return new a(t,0);}static Vertical(t){return new a(0,t);}static get Zero(){return new a(0,0);}sum(t){return new a(this.x+t.x,this.y+t.y);}diff(t){return new a(this.x-t.x,this.y-t.y);}getMagnitude(){return Math.sqrt(this.x**2+this.y**2);}copy(){return new a(this.x,this.y);}}const T=class T{};T.ENEMY_FIRE_RATIO=400,T.ENEMY_HORD_REFIRE_DELAY=300,T.ENEMY_HORD_START_FIRE_DELAY=1500,T.ENEMY_LASER_SPEED=10,T.ENEMY_MOVING_ANIMATION_INTERVAL=200,T.ENEMY_FIRE_SPRITE_FIXINESS=600,T.ENEMY_COLLIDER_RADIUS=13,T.ENEMY_HORD_SPAWN_POSITION_X_BY_SCREEN=.05,T.ENEMY_HORD_SPAWN_POSITION_Y_BY_SCREEN=.07,T.ENEMY_HORD_HORIZONTAL_GAP_BY_SCREEN=.052,T.ENEMY_HORD_VERTICAL_GAP_BY_SCREEN=.06,T.ENEMY_HORD_SPEED=new a(3,1),T.ENEMY_HORD_ACCELERATION_X=.05,T.ENEMY_HORD_ACCELERATION_INTERVAL=250,T.ENEMY_HORD_MOVING_DOWN_INTERVAL=250;let O=T;class M{constructor(t,e){this._width=t,this._height=e;}get width(){return this._width;}set width(t){if(t<0)throw new Error("Invalid width");this._width=t;}get height(){return this._height;}set height(t){if(t<0)throw new Error("Invalid height");this._height=t;}replace(t){this.width=t.width,this.height=t.height;}}var d=(i=>(i.FPS="#ffff00",i.Dark="#000000",i.Light="#ffffff",i.Space="#16081d",i.Highlighted="#4EFF21",i.Overlay="#000000aa",i.LatestScore="#C1FFC3",i.FirstScore="#4EE995",i.SecondScore="#E2FF6F",i.ThirdScore="#FF6F6F",i.HighlightedSoftText="#D5FFD7",i.OutstandingText="#E9E9AA",i.PlayerHUD="#6DE4A4",i.Debug="#00FF00AA",i))(d||{});class zi{constructor(t){this.context=t.getContext("2d");}setOpacity(t,e){this.context.globalAlpha=t,e(),this.context.globalAlpha=1;}setColor(t,e){const s=this.context.fillStyle;this.context.fillStyle=t,e(),this.context.fillStyle=s;}getTextWidth(t,e){const s=this.context.font;this.context.font=e.value;const r=this.context.measureText(t).width;return this.context.font=s,r;}setFont(t,e){const s=this.context.font;this.context.font=t.value,e(),this.context.font=s;}setAlignment(t,e){const s=this.context.textAlign;this.context.textAlign=t,e(),this.context.textAlign=s;}clearScreen(){const{width:t,height:e}=this.context.canvas;this.setColor(d.Dark,()=>{this.context.fillRect(0,0,t,e);});}rotate(t,e,s){const{context:r}=this;r.save(),r.translate(t.x,t.y),r.rotate(e*Math.PI/180),s(),r.restore();}}const Y=class Y{constructor(){this.canvas=document.getElementById("game"),this.renderer=new zi(this.canvas),this.setupDimensions();}static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance;}setupDimensions(){this.setCanvasSize(new M(Y.SCREEN_MEASURE*Y.ASPECT_RATIO,Y.SCREEN_MEASURE)),this.adjustCanvasElementSize(),window.addEventListener("resize",()=>this.adjustCanvasElementSize());}adjustCanvasElementSize(){const{width:t,height:e}=document.documentElement.getBoundingClientRect(),s=this.canvas;s.style.width="unset",s.style.height=`${e}px`,s.clientWidth>t&&(s.style.width=`${t}px`,s.style.height="unset"),s.clientHeight>e&&(s.style.width="unset",s.style.height=`${e}px`);}setCanvasSize({width:t,height:e}){this.canvas.width=t,this.canvas.height=e;}get canvasSize(){return new M(this.canvas.width,this.canvas.height);}get halfScreenWidth(){return this.getMeasureByScreenWidth(.5);}get halfScreenHeight(){return this.getMeasureByScreenHeight(.5);}getPositionByScreen(t,e){return new a(this.getMeasureByScreenWidth(t),this.getMeasureByScreenHeight(e));}getCenterPosition(t){return this.getPositionByScreen(.5,.5).diff(new a(t.width*.5,t.height*.5));}getMeasureByScreenWidth(t){return this.canvas.width*t;}getMeasureByScreenHeight(t){return this.canvas.height*t;}clearScreen(){this.renderer.clearScreen();}};Y.ASPECT_RATIO=16/9,Y.SCREEN_MEASURE=700;let h=Y;var si=(i=>(i.Retron2000="Retron2000",i))(si||{});const E=class E{};E.DEFAULT_LANG=Ae.Spanish,E.DEFAULT_FONT=si.Retron2000,E.SOUNDTRACK_MAX_VOLUME=.3,E.SFX_MAX_VOLUME=.6,E.SHIELD_DAMAGE_CAPACITY=9,E.WEAK_ENEMY_DAMAGE_CAPACITY=3,E.REGULAR_ENEMY_DAMAGE_CAPACITY=4,E.STRONG_ENEMY_DAMAGE_CAPACITY=5,E.WEAK_ENEMY_SCORE_POINTS=80,E.REGULAR_ENEMY_SCORE_POINTS=100,E.STRONG_ENEMY_SCORE_POINTS=120,E.ENEMY_LASER_TAG="enemy",E.WINNING_PLAYER_LIFE_INCREMENT=1,E.INDIVIDUAL_PLAYER_LIFES=5,E.MULTIPLAYER_PLAYER_LIFES=3,E.PLAYER_LASER_TAG="player",E.PLAYER_NICKNAME_MAX_LENGTH=15,E.PLAYER_FIRE_RATIO_IN_MS=140,E.PLAYER_LASER_SPEED=14,E.TOP_SCORE_COUNT=3,E.LATEST_SCORE_COUNT=5,E.GAME_SCENE_BACKGROUND_SPEED=6,E.GAME_MENU_SCENE_BACKGROUND_SPEED=2;let u=E;class Mt{constructor(t){this.points=t;}static WeakEnemyScorePoints(){return new Mt(u.WEAK_ENEMY_SCORE_POINTS);}static RegularEnemyScorePoints(){return new Mt(u.REGULAR_ENEMY_SCORE_POINTS);}static StrongEnemyScorePoints(){return new Mt(u.STRONG_ENEMY_SCORE_POINTS);}}class N{constructor(t,e){this.action=t,this.timeout=e,this.nowTime=0,this.lastTime=0,this.elapsedTime=0,this.stopped=!0;}update(){if(this.checkPastTimeout()){this.pastTimeout();return;}this.stopped||(this.nowTime=performance.now(),this.elapsedTime+=this.nowTime-this.lastTime,this.lastTime=this.nowTime);}checkPastTimeout(){return this.elapsedTime>=this.timeout;}start(){this.stopped=!1,this.elapsedTime=0,this.lastTime=performance.now();}stop(){this.stopped=!0;}get isStopped(){return this.stopped;}pastTimeout(){this.elapsedTime=0,this.action();}}class ft{constructor(t,e){this.interval=e,this.frames=t,this.indexCurrentFrame=0,this.timer=new N(()=>this.tick(),e),this.timer.start();}get currentFrame(){return this.frames[this.indexCurrentFrame];}update(){this.timer.update();}tick(){this.indexCurrentFrame=(this.indexCurrentFrame+1)%this.frames.length;}}class ii{getCenter(){return new a(this.position.x+this.width*.5,this.position.y+this.height*.5);}}class _{constructor({image:t,position:e,size:s,degrees:r}){this.renderProvider=h.getInstance(),this.image=t,this.position=e,this.size=s||new M(t.width,t.height),this.degrees=r;}scale(t){this.size.width=this.size.width*t,this.size.height=this.size.height*t;}render(){const{renderer:t}=this.renderProvider,{x:e,y:s}=this.position;if(!this.size){t.context.drawImage(this.image,e,s);return;}const{width:r,height:n}=this.size;if(!this.degrees){t.context.drawImage(this.image,e,s,r,n);return;}t.rotate(this.position,this.degrees,()=>{const o=new a(-r*.5,-n*.5);t.context.drawImage(this.image,o.x,o.y,r,n);});}}class wt extends ii{constructor(t,e,s=1){super(),this._spriteImage=new _({image:e,position:t}),this._spriteImage.scale(s),this.renderProvider=h.getInstance(),this.scale=s;}get position(){return this._spriteImage.position;}get sprite(){return this._spriteImage.image;}get width(){return this._spriteImage.size.width;}get height(){return this._spriteImage.size.height;}get size(){return this._spriteImage.size;}}class Ot{constructor(){this.lasers=new Map,this.renderProvider=h.getInstance();}static getInstance(){return this.instance||(this.instance=new Ot),this.instance;}get size(){return this.lasers.size;}isOutOfBounds(t){const{y:e}=t.position;return e<-t.height||e>this.renderProvider.canvasSize.height;}generate(t){this.lasers.set(t.id,t);}destroy(t){this.lasers.delete(t.id);}update(){this.forEachLaser(t=>{t.update(),this.isOutOfBounds(t)&&this.destroy(t);});}render(){this.forEachLaser(t=>t.render());}checkLaserCollision(t,e){for(const s of this.lasers.values())if(!(t!==s.tag||!s.collider.isCollidesWith(e)))return this.destroy(s),s;return null;}checkCollisionBetweenLasers(t){const e=this.lasers.values();for(const s of e)for(const r of e)s.tag===r.tag||!s.collider.isCollidesWith(r.collider)||(this.destroy(s),this.destroy(r),t(s,r));}forEachLaser(t){this.lasers.forEach(t);}}var z=(i=>(i[i.Forward=-1]="Forward",i[i.Backward=1]="Backward",i))(z||{});class ri{constructor(t){this.position=t,this.renderer=h.getInstance().renderer;}}class Ui extends ri{constructor(t,e,s=d.Dark){super(t),this.position=t,this.radius=e,this.color=s;}render(t=this.color){const{context:e}=this.renderer,{x:s,y:r}=this.position,{radius:n}=this;this.renderer.setColor(t,()=>{e.beginPath(),e.arc(s,r,n,0,2*Math.PI),e.fill();});}}class ls{constructor(t,e,s=a.Zero){this.gameObject=t,this.radius=e,this.offset=s,this.circle=new Ui(this.gameObject.getCenter().sum(this.offset),this.radius);}isCollidesWith(t){const e=this.gameObject.getCenter().sum(this.offset).diff(t.gameObject.getCenter()).getMagnitude();return t.radius+this.radius>=e;}render(t=d.Debug){this.circle.render(t);}}const ae=class ae{};ae.LASER_SCALE=1,ae.COLLIDER_RADIUS=13,ae.COLLIDER_OFFSET_Y=10;let se=ae;class Ai extends wt{constructor(t,e,s,r,n){super(n.copy(),r,se.LASER_SCALE),this.tag=t,this.speed=e,this.direction=s,this.id=crypto.randomUUID(),this.collider=this.createCollider(),this.centerByLaser();}centerByLaser(){this._spriteImage.position=this._spriteImage.position.diff(a.Horizontal(this.width/2));}createCollider(){return new ls(this,se.COLLIDER_RADIUS,a.Vertical(this.direction*se.COLLIDER_OFFSET_Y));}update(){this.position.y+=this.speed*this.direction;}render(){this._spriteImage.render();}}class Ki extends Ai{constructor(t){super(u.ENEMY_LASER_TAG,O.ENEMY_LASER_SPEED,z.Backward,c.spriteManager.ENEMY_LASER,t);}}function Ct(i){let t;return()=>(t||(t=new i),t);}const Qe=class Qe{constructor(t,e){this.audioComponent=t,this.timer=new N(()=>this.volumeInterpolation&&this.volumeInterpolation(),Qe.INTERVAL_INTERPOLATION_VOLUME),this._currentVolume=e,this.audioComponent.volume=e;}update(){this.timer.update();}setVolume(t){if(t===this._currentVolume)return;this._currentVolume=t;const e=this.audioComponent.volume,s=(t-e)/this.timer.timeout,r=n=>s>0?n>=t:n<=t;this.volumeInterpolation=()=>{let n=this.audioComponent.volume+s;n=parseFloat(n.toFixed(3)),r(n)&&(n=t,this.volumeInterpolation=void 0,this.timer.stop()),this.audioComponent.volume=n;},this.timer.start();}setVolumeForce(t){this.audioComponent.volume=t,this._currentVolume=t;}};Qe.INTERVAL_INTERPOLATION_VOLUME=10;let _s=Qe;var mt=(i=>(i[i.Mute=0]="Mute",i[i.Low=1]="Low",i[i.Medium=2]="Medium",i[i.High=3]="High",i))(mt||{});function Pi(i,t){return Object.values(i).includes(t);}class ni extends Error{constructor(t){super(t);}static AudioVolumeLevelNotExists(){return new ni("The level is not defined");}}const Yt=class Yt{constructor(t){this.scoreRepository=t;}existScoreRecords(){const t=this.scoreRepository.getLatestScores(),e=this.scoreRepository.getTopScores();return t.length>0&&e.length>0;}getHighScore(){return this.scoreRepository.getHighScore().value;}saveScore(t){this.scoreRepository.saveScoreRecord(t),this.scoreRepository.replaceSomeTopScoreIfNecessary(t);}getTopScores(){return this.scoreRepository.getTopScores();}getLatestScores(){return this.scoreRepository.getLatestScores();}static getScoreFormat(t){return t.toString().padStart(Yt.MAX_FIGURE_SCORE,Yt.DEFAULT_DIGIT);}};Yt.MAX_FIGURE_SCORE=7,Yt.DEFAULT_DIGIT="0";let Ce=Yt;class Zi{constructor(t){this.repository=t;}getPreferredLanguage(){return this.repository.getPreferredLanguage();}savePreferredLanguage(t){this.repository.savePreferredLanguage(t);}}class Xi{constructor(t){this.repository=t;}getLevel(){return this.repository.getLevel();}saveLevel(t){this.repository.saveLevel(t);}}class xe{constructor(t){this.key=t;}get(){const t=localStorage.getItem(this.key);return t?JSON.parse(t):null;}set(t){localStorage.setItem(this.key,JSON.stringify(t));}}const oe=class oe{constructor(){this.entity=new xe(oe.KEY);}static getInstance(){return this.instance??(this.instance=new oe),this.instance;}getLevel(){return this.entity.get();}saveLevel(t){this.entity.set(t);}};oe.KEY="preferredAudioVolumeLevel";let As=oe;class ji extends Error{constructor(t){super(t),this.name="ScoreError";}}class Ps{constructor(t){const e=parseInt(t);if(!Number.isInteger(e))throw new ji("Invalid score points");this.value=e;}}class mi extends Error{constructor(t){super(t),this.name="GameRepositoryError";}}function $i(i){const t=i.getDate().toString().padStart(2,"0"),e=i.getMonth().toString().padStart(2,"0"),s=i.getFullYear().toString();return`${t}/${e}/${s}`;}function Qi(i){const t=i.getHours().toString().padStart(2,"0"),e=i.getMinutes().toString().padStart(2,"0");return`${t}:${e}`;}var St;const qi=Ct((St=class{constructor(){this.latestScoreEntity=new xe(St.LATEST_SCORE_LOCAL_STORAGE_KEY),this.topScoreEntity=new xe(St.TOP_SCORE_LOCAL_STORAGE_KEY);}getHighScore(){const t=this.topScoreEntity.get();return!t||t.length===0?new Ps(0):new Ps(t[0].points);}getTopScores(){const t=this.topScoreEntity.get();if(!t||t.length===0)return[];const e=t.map(s=>this.getScoreRecord(s));return e.length=u.TOP_SCORE_COUNT,e;}getLatestScores(){const t=this.latestScoreEntity.get();if(!t||t.length===0)return[];const e=t.map(s=>this.getScoreRecord(s));return e.length=u.LATEST_SCORE_COUNT,e;}getScoreRecord(t){const e=new Date(t.dateTime);return{points:t.points,date:$i(e),time:Qi(e)};}replaceScore(t,e){for(const s in t){const{points:r}=t[s];if(e.points>r)return t[s]=e,!0;}return!1;}replaceSomeTopScoreIfNecessary(t){try{const e=this.topScoreEntity.get(),s={points:t.value,dateTime:new Date().toJSON()};if(!e||e.length===0){this.topScoreEntity.set([s]);return;}if(e.sort((n,o)=>o.points-n.points),this.replaceScore(e,s)||e.length>=u.TOP_SCORE_COUNT){this.topScoreEntity.set(e);return;}e.push(s),this.topScoreEntity.set(e);}catch{throw new mi("Couldn't save high score record");}}saveScoreRecord(t){try{const e=this.latestScoreEntity.get()||[];e.unshift({points:t.value,dateTime:new Date().toJSON()}),e.length>u.LATEST_SCORE_COUNT&&(e.length=u.LATEST_SCORE_COUNT),this.latestScoreEntity.set(e);}catch{throw new mi("Couldn't save score record");}}},St.LATEST_SCORE_LOCAL_STORAGE_KEY="latestScoreHistory",St.TOP_SCORE_LOCAL_STORAGE_KEY="topScoreHistory",St));var Jt;const Ji=Ct((Jt=class{constructor(){this.entity=new xe(Jt.KEY);}getPreferredLanguage(){return this.entity.get();}savePreferredLanguage(t){this.entity.set(t);}},Jt.KEY="preferredLanguage",Jt));class Pe{static getScoreService(){return new Ce(qi());}static getPreferredLanguageService(){return new Zi(Ji());}static getPreferredAudioVolumeLevelService(){return new Xi(As.getInstance());}}const ai=Ct(class{constructor(){this.preferredAudioVolumeLevel=Pe.getPreferredAudioVolumeLevelService(),this.resources=[],this._level=this.initialLevel();}initialLevel(){const t=this.preferredAudioVolumeLevel.getLevel();return t!==null?t:mt.High;}get level(){return this._level;}addResource(t){this.resources.push(t);}change(t){if(!Pi(mt,t))throw ni.AudioVolumeLevelNotExists();this.preferredAudioVolumeLevel.saveLevel(t),this._level=t,this.resources.forEach(e=>{e.changeLevel();});}calculateVolume(t,e){return t*e*this._level/mt.High;}});var Xt=(i=>(i[i.Muted=0]="Muted",i[i.Blurred=.5]="Blurred",i[i.Max=1]="Max",i))(Xt||{});class yi{constructor({audioComponent:t,maxVolume:e,tag:s}){this.audioComponent=t,this.currentPercentVolume=Xt.Max,this.maxVolume=e,this.tag=s,this.volumeController=new _s(t,e),this.audioVolumeLevelManager=ai();}play(){this.audioComponent.play();}changeLevel(){this.volumeController.setVolume(this.audioVolumeLevelManager.calculateVolume(this.currentPercentVolume,this.maxVolume));}standarizeLevel(){this.volumeController.setVolumeForce(this.audioVolumeLevelManager.calculateVolume(this.currentPercentVolume,this.maxVolume));}changeVolume(t){this.currentPercentVolume=t,this.volumeController.setVolume(this.audioVolumeLevelManager.calculateVolume(t,this.maxVolume));}update(){this.volumeController.update();}}class tr{constructor(t,e){this.audioBuffer=t,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination);}get volume(){return this.gainNode.gain.value;}set volume(t){this.gainNode.gain.value=t;}play(){const t=this.audioContext.createBufferSource();t.buffer=this.audioBuffer,t.connect(this.gainNode),t.start(),t.onended=()=>{t.disconnect();};}}class er extends yi{constructor(t,e){super({audioComponent:new tr(t,dt().audioContext),maxVolume:u.SFX_MAX_VOLUME,tag:e}),this.audioVolumeLevelManager.addResource(this);}}class Li{constructor(t){this.sources=t;}async load(){await Promise.all(this.sources.map(t=>this.loadSource(t)));}}var ct=(i=>(i.Wav="wav",i.Mp3="mp3",i))(ct||{});const sr=[{fileName:"enemy_fire",format:ct.Wav},{fileName:"entity_death",format:ct.Wav},{fileName:"explosion",format:ct.Wav},{fileName:"mouse_click",format:ct.Wav},{fileName:"mouse_hover",format:ct.Wav},{fileName:"player_fire",format:ct.Wav}];class jt extends Error{constructor(t){super(t);}static AudioNotFound(t){return new jt(`Audio "${t}" not found`);}static FailedToLoadAudio(t){return new jt(`Failed to load audio "${t}"`);}}class ir extends Li{constructor(t){super(sr),this.sfxMap=t,this.audioContext=new AudioContext;}async loadSource(t){const{fileName:e,format:s}=t,r=`${e}.${s}`;try{const o=await(await fetch(ds(`sfx/${r}`))).arrayBuffer(),l=await this.audioContext.decodeAudioData(o),I=new er(l,e);I.standarizeLevel(),this.sfxMap.set(e,I);}catch{throw jt.FailedToLoadAudio(r);}}}class Mi{constructor(t,e){this.audios=t,this.loader=e;}async init(){await this.loader.load();}getResource(t){const e=this.audios.get(t);if(!e)throw jt.AudioNotFound(t);return e.standarizeLevel(),e;}}const rr=Ct(class extends Mi{constructor(){const t=new Map;super(t,new ir(t));}get audioContext(){return this.loader.audioContext;}update(){this.audios.forEach(t=>t.update());}}),dt=rr;class $t{static get Explosion(){return dt().getResource("explosion");}static get PlayerFire(){return dt().getResource("player_fire");}static get EnemyFire(){return dt().getResource("enemy_fire");}static get MouseClick(){return dt().getResource("mouse_click");}static get MouseHover(){return dt().getResource("mouse_hover");}static get EntityDeath(){return dt().getResource("entity_death");}}class nr{constructor(t){this.enemy=t,this.laserController=Ot.getInstance(),this.canFire=!0,this.timerFireRatio=new N(()=>this.enableFire(),O.ENEMY_FIRE_RATIO);}fire(){this.canFire&&(this.createLaser(),this.canFire=!1,this.timerFireRatio.start(),$t.EnemyFire.play());}update(){this.timerFireRatio.update();}get isFiring(){return!this.timerFireRatio.isStopped;}enableFire(){this.canFire=!0,this.timerFireRatio.stop();}createLaser(){const{enemy:t}=this,e=t.position.sum(a.Horizontal(t.width/2));this.laserController.generate(new Ki(e));}}class ar{constructor(t){this._sprite=t,this.shown=!1,this.timer=new N(()=>{this.shown=!1,this.timer.stop();},O.ENEMY_FIRE_SPRITE_FIXINESS),this.timer.start();}update(){this.timer.update();}get isShown(){return this.shown;}get sprite(){return this._sprite;}show(){this.shown=!0,this.timer.start();}}class oi extends wt{constructor(t,e,s,r){super(t,e.moving[0],1),this.maxDamageCounter=s,this.scorePoints=r,this.id=crypto.randomUUID(),this.fireController=new nr(this),this.movingAnimator=new ft(e.moving,O.ENEMY_MOVING_ANIMATION_INTERVAL),this.fireSprite=new ar(e.fire),this.collider=new ls(this,O.ENEMY_COLLIDER_RADIUS),this.damageCounter=0;}update(){this.movingAnimator.update(),this.fireController.isFiring&&this.fireSprite.show(),this.fireController.update(),this.fireSprite.update();}render(){this.fillSprite(),this._spriteImage.render();}damage(){this.isDestroyed||this.damageCounter++;}fire(){this.fireController.fire();}get isDestroyed(){return this.damageCounter>=this.maxDamageCounter;}fillSprite(){this._spriteImage.image=this.fireSprite.isShown?this.fireSprite.sprite:this.movingAnimator.currentFrame;}}class or extends oi{constructor(t){const e=c.spriteManager.REGULAR_ENEMY;super(t,e,u.REGULAR_ENEMY_DAMAGE_CAPACITY,Mt.RegularEnemyScorePoints());}}class hr extends oi{constructor(t){const e=c.spriteManager.STRONG_ENEMY;super(t,e,u.STRONG_ENEMY_DAMAGE_CAPACITY,Mt.StrongEnemyScorePoints());}}class cr extends oi{constructor(t){const e=c.spriteManager.WEAK_ENEMY;super(t,e,u.WEAK_ENEMY_DAMAGE_CAPACITY,Mt.WeakEnemyScorePoints());}}function Qt(i){return Math.floor(Math.random()*i);}function dr(i){const t=Qt(i);return Math.random()>.5?t:-t;}class lr{constructor(t){this.getEnemyList=t,this.refireTimer=new N(()=>{this.generateRandomFireEnemy();},O.ENEMY_HORD_REFIRE_DELAY),this.startFireTimer=new N(()=>{this.refireTimer.start(),this.startFireTimer.stop();},O.ENEMY_HORD_START_FIRE_DELAY),this.startFireTimer.start();}update(){this.startFireTimer.isStopped?this.refireTimer.update():this.startFireTimer.update();}generateRandomFireEnemy(){const t=this.getEnemyList();if(t.length===0&&!this.refireTimer.isStopped){this.refireTimer.stop();return;}const e=Qt(t.length);t[e].fire();}}class ur{constructor(t){this.getEnemyList=t,this.direction=z.Backward,this.renderProvider=h.getInstance(),this.enemies=[],this.isMovingDown=!1,this.speed=O.ENEMY_HORD_SPEED.copy(),this.accelerationTimer=new N(()=>{this.speed=this.speed.sum(a.Horizontal(O.ENEMY_HORD_ACCELERATION_X));},O.ENEMY_HORD_ACCELERATION_INTERVAL),this.accelerationTimer.start(),this.moveDownTimer=new N(()=>this.isMovingDown=!1,O.ENEMY_MOVING_ANIMATION_INTERVAL);}update(){this.accelerationTimer.update(),this.moveDownTimer.update(),this.enemies=this.getEnemyList(),this.move(),this.checkChangeDirection();}move(){this.enemies.forEach(t=>{this.isMovingDown?t.position.y+=this.speed.y:t.position.x+=this.speed.x*this.direction;});}changeDirection(t){this.direction=t,this.isMovingDown=!0,this.moveDownTimer.start();}checkChangeDirection(){this.isMovingDown||(this.enemies.some(t=>t.position.x<=0)?this.changeDirection(1):this.enemies.some(t=>t.position.x>=this.renderProvider.canvasSize.width-t.width)&&this.changeDirection(-1));}}class gr{constructor(t){this.enemies=this.createEnemies(t);const e=()=>this.getEnemyList();this.hordFireController=new lr(e),this.hordMovementController=new ur(e);}update(){this.forEachEnemy(t=>t.update()),this.hordMovementController.update(),this.hordFireController.update();}render(){this.forEachEnemy(t=>t.render());}get noEnemies(){return this.enemies.size===0;}destroy(t){this.enemies.delete(t.id);}forEachEnemy(t){this.enemies.forEach(t);}getEnemyList(){return Array.from(this.enemies.values());}createEnemies(t){const e=new Map,s=h.getInstance(),r=s.getPositionByScreen(O.ENEMY_HORD_SPAWN_POSITION_X_BY_SCREEN,O.ENEMY_HORD_SPAWN_POSITION_Y_BY_SCREEN);let n=r.x,o=r.y;const l=s.getPositionByScreen(O.ENEMY_HORD_HORIZONTAL_GAP_BY_SCREEN,O.ENEMY_HORD_VERTICAL_GAP_BY_SCREEN);let I=0,m;for(I;I<t;I++)m=new hr(new a(n,o)),e.set(m.id,m),n+=l.x;for(o+=l.y,n=r.x,I;I<t*2;I++)m=new or(new a(n,o)),e.set(m.id,m),n+=l.x;for(o+=l.y,n=r.x,I;I<t*3;I++)m=new cr(new a(n,o)),e.set(m.id,m),n+=l.x;return e;}}const he=class he{};he.SHIELD_QUANTITY_IN_LINE=4,he.COLLIDER_RADIUS=36,he.SHIELD_LINE_SPAWN_POSITION_Y_BY_SCREEN=.62;let me=he;class pr extends ft{constructor(t,e){super(t,e),this._isPlaying=!0;}get isPlaying(){return this._isPlaying;}update(){this._isPlaying&&super.update();}tick(){if(this.indexCurrentFrame<this.frames.length-1){this.indexCurrentFrame++;return;}this.indexCurrentFrame=0,this._isPlaying=!1,this.clear&&this.clear();}onClear(t){this.clear=t;}}const Vt=class Vt{constructor(t,e){this.id=crypto.randomUUID(),this.animator=new pr(c.spriteManager.EXPLOSION,Vt.ANIMATION_INTERVAL);const s=t.diff(new a(this.animator.currentFrame.width*.5+this.getRandomOffset(e),this.animator.currentFrame.height*.5));this.spriteImage=new _({image:this.animator.currentFrame,position:s});}onClear(t){this.animator.onClear(()=>t(this.id));}update(){this.animator.update(),this.spriteImage.image=this.animator.currentFrame;}render(){this.spriteImage.render();}getRandomOffset(t){return t?dr(Vt.SPAWN_POSITION_OFFSET):0;}};Vt.SPAWN_POSITION_OFFSET=30,Vt.ANIMATION_INTERVAL=50;let ys=Vt;class D{constructor(){this.explosionEffects=new Map;}static getInstance(){return D.instance||(D.instance=new D),D.instance;}update(){this.forEachExplosionEffect(t=>t.update());}render(){this.forEachExplosionEffect(t=>t.render());}play(t,e){const s=new ys(t.getCenter(),!(typeof e>"u"));s.onClear(r=>this.explosionEffects.delete(r)),this.explosionEffects.set(s.id,s),$t.Explosion.play();}forEachExplosionEffect(t){this.explosionEffects.forEach(t);}}class Er extends wt{constructor(t){const e=c.spriteManager.SHIELD;super(t,e.noDamage,1.6),this.id=crypto.randomUUID(),this.sprites=[e.noDamage,e.damaged,e.veryDamaged],this.collider=new ls(this,me.COLLIDER_RADIUS),this.damageCounter=0,this.explosionEffectManager=D.getInstance();}update(){}render(){this._spriteImage.render();}damage(){if(this.isDestroyed){this.explosionEffectManager.play(this,!1);return;}this.damageCounter++,this._spriteImage.image=this.sprites[this.spriteIndex];}smash(){this.damageCounter=u.SHIELD_DAMAGE_CAPACITY;}get isDestroyed(){return this.damageCounter>=u.SHIELD_DAMAGE_CAPACITY;}get spriteIndex(){return Math.floor(this.damageCounter*this.sprites.length/u.SHIELD_DAMAGE_CAPACITY);}}class hi{constructor(){this.shields=this.createShields();}update(){this.forEachShield(t=>t.update());}render(){this.forEachShield(t=>t.render());}destroy(t){this.shields.delete(t.id);}forEachShield(t){this.shields.forEach(t);}static calculateSpaceBetweenShields(t,e,s){return(t-e*s)/(s+1);}createShields(){const t=new Map,e=me.SHIELD_QUANTITY_IN_LINE;let s=0;const{canvasSize:r}=h.getInstance(),n=r.height*me.SHIELD_LINE_SPAWN_POSITION_Y_BY_SCREEN;for(let o=0;o<e;o++){const l=new Er(new a(s,n));s+=hi.calculateSpaceBetweenShields(r.width,l.width,e),l.position.x=s,t.set(l.id,l),s+=l.width;}return t;}}class mr{constructor(t){this.shieldLine=t,this.explosionEffectManager=D.getInstance(),this.laserController=Ot.getInstance();}update(){this.shieldLine.forEachShield(t=>{this.checkCollisionWithPlayerLaser(t),this.checkShieldDamage(t);});}checkCollisionWithPlayerLaser(t){const e=this.laserController.checkLaserCollision(u.PLAYER_LASER_TAG,t.collider);e&&this.explosionEffectManager.play(e);}checkShieldDamage(t){const e=this.laserController.checkLaserCollision(u.ENEMY_LASER_TAG,t.collider);e&&(this.explosionEffectManager.play(e),t.damage(),t.isDestroyed&&this.shieldLine.destroy(t));}}class Ir{constructor(t,e){this.enemyHord=t,this.gameManager=e,this.explosionEffectManager=D.getInstance(),this.laserController=Ot.getInstance();}update(){this.checkCollisionWithAllPlayerLasers();}checkCollisionWithAllPlayerLasers(){this.enemyHord.forEachEnemy(t=>{this.checkCollisionWithPlayerLaser(t);});}checkCollisionWithPlayerLaser(t){const e=this.laserController.checkLaserCollision(u.PLAYER_LASER_TAG,t.collider);e&&(this.damageEnemy(t,e),t.isDestroyed&&(this.destroyEnemy(t),$t.EntityDeath.play()));}damageEnemy(t,e){t.damage(),this.explosionEffectManager.play(e);}destroyEnemy(t){this.explosionEffectManager.play(t,!1),this.enemyHord.destroy(t),this.gameManager.incrementScore(t.scorePoints);}}class Sr{constructor(t,e){this.playerManager=t,this.gameManager=e,this.explosionEffectManager=D.getInstance(),this.laserController=Ot.getInstance();}update(){this.playerManager.forEachPlayer(t=>{this.checkPlayerDamage(t);}),this.laserController.checkCollisionBetweenLasers((t,e)=>{this.explosionEffectManager.play(t,!1),this.explosionEffectManager.play(e,!1);});}checkPlayerDamage(t){if(t.isInvincible)return;const e=this.laserController.checkLaserCollision(u.ENEMY_LASER_TAG,t.collider);e&&(this.explosionEffectManager.play(e),t.damage(),t.isDead&&this.playerManager.noPlayers&&this.gameManager.saveScore());}}var f=(i=>(i[i.FirePlayerOne=0]="FirePlayerOne",i[i.LeftPlayerOne=1]="LeftPlayerOne",i[i.RightPlayerOne=2]="RightPlayerOne",i[i.FirePlayerTwo=3]="FirePlayerTwo",i[i.LeftPlayerTwo=4]="LeftPlayerTwo",i[i.RightPlayerTwo=5]="RightPlayerTwo",i[i.Pause=6]="Pause",i[i.Enter=7]="Enter",i[i.Exit=8]="Exit",i))(f||{});class fr{constructor(t){this.map=t,this.keyset=new Set,window.addEventListener("keydown",e=>{this.checkIfMapContainsKey(e,s=>this.addKeyToSet(s));}),window.addEventListener("keyup",e=>{this.checkIfMapContainsKey(e,s=>this.removeKeyToSet(s));});}checkIfMapContainsKey(t,e){const s=t.key.toLowerCase();this.map.has(s)&&e(this.map.get(s));}addKeyToSet(t){this.keyset.add(t);}removeKeyToSet(t){this.keyset.delete(t);}hasPulsed(t){return this.keyset.has(t);}}var K=(i=>(i.A="a",i.D="d",i.W="w",i.ArrowLeft="arrowleft",i.ArrowRight="arrowright",i.ArrowUp="arrowup",i.Backspace="backspace",i.Enter="enter",i.Esc="escape",i))(K||{});class J{constructor(){this.keymap=new Map([[K.A,f.LeftPlayerOne],[K.D,f.RightPlayerOne],[K.W,f.FirePlayerOne],[K.ArrowLeft,f.LeftPlayerTwo],[K.ArrowRight,f.RightPlayerTwo],[K.ArrowUp,f.FirePlayerTwo],[K.Enter,f.Enter],[K.Backspace,f.Pause],[K.Esc,f.Exit]]),this.gameControlManager=new fr(this.keymap);}static getInstance(){return J.instance||(J.instance=new J),J.instance;}hasPulsed(t){return this.gameControlManager.hasPulsed(t);}}const bt=class bt{constructor(){this.renderProvider=h.getInstance(),this.sprite=c.spriteManager.PAUSE,this.spriteImage=new _({image:c.spriteManager.PAUSE,position:a.Zero}),this.timer=new N(()=>this.changeJumpDirection(),bt.JUMP_DIRECTION_CHANGE_TIME),this.timer.start(),this.direction=1;}update(){this.calculatePosition(),this.timer.update();}render(){this.spriteImage.render();}changeJumpDirection(){this.direction=this.direction>0?z.Forward:z.Backward;}calculatePosition(){const{renderProvider:t,direction:e}=this,s=t.halfScreenWidth-this.sprite.width/2,r=t.halfScreenHeight-this.sprite.height/2;this.spriteImage.position=new a(s,r+e*bt.JUMP_OFFSET);}};bt.JUMP_OFFSET=15,bt.JUMP_DIRECTION_CHANGE_TIME=750;let Ls=bt;const ye=Ct(class{change(t){var e;(e=this._currentTrack)==null||e.audioComponent.stop(),this._currentTrack=t;}get currentTrack(){if(!this._currentTrack)throw new Error("Audio not setted");return this._currentTrack;}get hasTrack(){return!!this._currentTrack;}});class Tr{constructor(){this.gameControlProvider=J.getInstance(),this._isPaused=!1,this.pauseMessage=new Ls,this.hasPulsedPauseButtonForFirstTime=!1,this.soundtrackManager=ye();}update(){this.checkPause(),this._isPaused&&this.pauseMessage.update();}render(){this._isPaused&&this.pauseMessage.render();}get isPaused(){return this._isPaused;}togglePause(){this._isPaused=!this._isPaused;const t=this.soundtrackManager.currentTrack;this._isPaused?t.changeVolume(Xt.Blurred):t.changeVolume(Xt.Max);}hasPulsePauseButton(){return this.gameControlProvider.hasPulsed(f.Pause);}checkPause(){this.hasPulsePauseButton()&&this.hasPulsedPauseButtonForFirstTime?(this.togglePause(),this.hasPulsedPauseButtonForFirstTime=!1):!this.hasPulsePauseButton()&&!this.hasPulsedPauseButtonForFirstTime&&(this.hasPulsedPauseButtonForFirstTime=!0);}}class ci{constructor(t){this._position=t;}get position(){return this._position;}}class di extends ci{constructor(t){super(t.position),this.textContent=t;}render(){this.textContent.render();}get height(){return this.textContent.height;}get width(){return this.textContent.width;}}class wr{constructor(t,e){this.visualElement=t,this.opacity=e,this.renderProvider=h.getInstance();}render(){this.renderProvider.renderer.setOpacity(this.opacity,()=>this.visualElement.render());}}class Or{constructor(t){this.initialPosition=t,this.offsetMemories=[];}addOffsetMemory(t){this.offsetMemories.push(t);}calculatePosition(){let t=this.initialPosition;return this.offsetMemories.forEach(e=>{t=t.sum(e());}),t;}get isEmpty(){return this.offsetMemories.length===0;}}class _r{constructor(t,e){this.font=t,this.size=e,this.value=`${e}px ${t}`;}}const X=class X{constructor(t,e,s,r){this.content=t,this.color=e,this.fontSize=s,this.textPositionMemory=new Or(r.copy()),this._position=r,this._alignment=X.DEFAULT_ALIGNMENT,this._opacity=1,this.content.addChangeValueListener(()=>{this.textPositionMemory.isEmpty||(this._position=this.textPositionMemory.calculatePosition());}),this.font=new _r(u.DEFAULT_FONT,s),this.renderer=h.getInstance().renderer;}static DefaultSize(t,e,s){return new X(t,e,X.DEFAULT_FONT_SIZE,s);}update(){this.content.onCheckChangeValue(this.content.getValue());}render(){this.renderer.setColor(this.color,()=>{this.writeText();});}get opacity(){return this._opacity;}set opacity(t){if(t<0)throw new Error("Only numbers be greater or equal to 0");this._opacity=t;}getTextLineLongest(t){return t.split(`
`).sort((s,r)=>r.length-s.length)[0];}writeText(){const{fontSize:t,position:e}=this,s=this.getTextLines(),r=t+X.LINE_HEIGHT,n=this.getTotalHeight(s,r);let o=e.y-n;this.renderer.setOpacity(this.opacity,()=>{s.forEach(l=>{this.writeTextLine(l,e.x,o+t*.5),o+=r;});});}writeTextLine(t,e,s){this.renderer.setFont(this.font,()=>{this.renderer.setAlignment(this._alignment,()=>{this.renderer.context.fillText(t,e,s);});});}getTextLines(){return this.content.getValue().split(`
`);}getTotalHeight(t,e){return e*t.length*.5-e*.5;}getLineCount(){return this.getTextLines().length;}get width(){const t=this.getTextLineLongest(this.content.getValue());return this.renderer.getTextWidth(t,this.font);}get height(){const t=this.getLineCount(),e=this.fontSize*t,s=X.LINE_HEIGHT*(t-1);return e+s;}get position(){return this._position;}set position(t){this._position=t;}set alignment(t){this._alignment=t;}addOffset(t){this._position=this._position.sum(t);}addOffsetAndRememberIt(t){this.addOffset(t()),this.textPositionMemory.addOffsetMemory(t);}};X.DEFAULT_FONT_SIZE=20,X.DEFAULT_ALIGNMENT="left",X.LINE_HEIGHT=8;let p=X;class Ni{constructor(){this.previousValue="";}addChangeValueListener(t){this.changeValueListener=t;}onCheckChangeValue(t){t!==this.previousValue&&(this.previousValue&&this.changeValueListener&&this.changeValueListener(),this.previousValue=t);}}const Ar="modulepreload",Pr=function(i){return"/invasores_p_web_sandbox/"+i;},Ii={},Me=function(t,e,s){if(!e||e.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(e.map(n=>{if(n=Pr(n),n in Ii)return;Ii[n]=!0;const o=n.endsWith(".css"),l=o?"[rel=\"stylesheet\"]":"";if(s)for(let _t=r.length-1;_t>=0;_t--){const Le=r[_t];if(Le.href===n&&(!o||Le.rel==="stylesheet"))return;}else if(document.querySelector(`link[href="${n}"]${l}`))return;const m=document.createElement("link");if(m.rel=o?"stylesheet":Ar,o||(m.as="script",m.crossOrigin=""),m.href=n,document.head.appendChild(m),o)return new Promise((_t,Le)=>{m.addEventListener("load",_t),m.addEventListener("error",()=>Le(new Error(`Unable to preload CSS for ${n}`)));});})).then(()=>t()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n;});},yr=(i,t)=>{const e=i[t];return e?typeof e=="function"?e():Promise.resolve(e):new Promise((s,r)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(r.bind(null,new Error("Unknown variable dynamic import: "+t)));});};class Ie extends Error{constructor(t){super(t);}static TextNotFound(t){return new Ie(`Text with id ${t} not exists`);}static LanguageIsNotDefined(t){return new Ie(`Lang ${t} is not defined`);}}class Fe{constructor(t){this.dictionary=t,this.lang=u.DEFAULT_LANG;}static async New(){return new Fe(await Fe.Dictionary());}static async Dictionary(){const t=new Map;for(const e of Zt)try{const s=new Map,r=(await yr(Object.assign({"../lang/en.json":()=>Me(()=>import("./en-f9bf9e6e.js"),[]),"../lang/es.json":()=>Me(()=>import("./es-887e88aa.js"),[]),"../lang/fr.json":()=>Me(()=>import("./fr-f5add9a5.js"),[]),"../lang/pt.json":()=>Me(()=>import("./pt-70c0b992.js"),[])}),`../lang/${e}.json`)).default;Object.entries(r).forEach(([n,o])=>{s.set(n,o);}),t.set(e,s);}catch{continue;}return t;}change(t){if(!Pi(Ae,t))throw Ie.LanguageIsNotDefined(t);this.lang=t;}getText(t){const s=this.dictionary.get(this.lang).get(t);if(!s)throw Ie.TextNotFound(t);return s;}}class tt{constructor(t){this.translationManager=t,this.preferredLanguageService=Pe.getPreferredLanguageService(),this._lang=this.retrieveLang(),t.change(this._lang);}static getInstance(){return tt.instance;}static async init(){tt.instance||(tt.instance=new tt(await Fe.New()));}retrieveLang(){const t=this.preferredLanguageService.getPreferredLanguage();return t||this.detectBrowserLang();}setLanguage(t){this.preferredLanguageService.savePreferredLanguage(t),this.translationManager.change(t),this._lang=t;}get lang(){return this._lang;}detectBrowserLang(){const t=window.navigator.language.slice(0,2);return Zt.includes(t)?t:Ae.English;}}class g extends Ni{constructor(t){super(),this.id=t,this.gameLanguageManager=tt.getInstance();}getValue(){return this.gameLanguageManager.translationManager.getText(this.id);}}const qe=class qe{constructor(t){const e=new p(new g("game_scene.text.game_exit"),d.Light,qe.GAME_EXIT_FONT_SIZE,t.copy());e.addOffset(a.Horizontal(-e.width*.5)),this.transparentEffect=new wr(new di(e),.5);}render(){this.transparentEffect.render();}};qe.GAME_EXIT_FONT_SIZE=20;let Ms=qe;class Ri{constructor(){this.currentScene=null;}changeScene(t){this.currentScene=t;}update(){var t;(t=this.currentScene)==null||t.update();}render(){var t;(t=this.currentScene)==null||t.render();}}class B extends Ri{constructor(){super();}static getInstance(){return B.instance||(B.instance=new B),B.instance;}}class Lr{constructor(t){this.element=t,t.preload="auto",t.loop=!0;}get volume(){return this.element.volume;}set volume(t){this.element.volume=t;}get isStopped(){return this.element.paused;}play(){this.element.play();}stop(){this.element.pause(),this.element.currentTime=0;}load(){return new Promise(t=>{this.element.addEventListener("canplaythrough",()=>t());});}}class Mr extends yi{constructor(t,e){super({audioComponent:new Lr(t),maxVolume:u.SOUNDTRACK_MAX_VOLUME,tag:e}),this.audioVolumeLevelManager.addResource(this);}stop(){this.audioComponent.volume===0&&(this.audioComponent.stop(),this.changeVolume(Xt.Max));}}const Nr=[{fileName:"menu",format:ct.Wav},{fileName:"game",format:ct.Wav}];class Rr extends Li{constructor(t){super(Nr),this.soundtrackMap=t,this.audioContext=new AudioContext;}async loadSource(t){const{fileName:e,format:s}=t,r=`${e}.${s}`;try{const n=new Audio(ds(`soundtrack/${r}`)),o=new Mr(n,e);o.standarizeLevel(),this.soundtrackMap.set(e,o);}catch{throw jt.FailedToLoadAudio(r);}}}const Ns=Ct(class extends Mi{constructor(){const t=new Map;super(t,new Rr(t));}});class vi{static get Menu(){return Ns().getResource("menu");}static get Game(){return Ns().getResource("game");}}class P extends Ri{constructor(){super();}static getInstance(){return P.instance||(P.instance=new P),P.instance;}}class vr extends ri{constructor(t,e,s=d.Dark){super(t),this.position=t,this.size=e,this.color=s;}render(){const{x:t,y:e}=this.position,{size:s}=this;this.renderer.setColor(this.color,()=>{this.renderer.context.fillRect(t,e,s,s);});}}const Je=class Je extends ii{constructor(t,e){super(),this.renderProvider=h.getInstance(),this.speed=e,this.square=new vr(t.copy(),Qt(Je.SCALE),d.Light);}get position(){return this.square.position;}update(){this.position.y+=this.speed;}render(){this.square.render();}startAgain(t){const{width:e}=this.renderProvider.canvasSize;t.position.x=Qt(e),t.position.y=0;}get width(){return this.square.size;}get height(){return this.square.size;}};Je.SCALE=9;let Rs=Je;class Cr{constructor(t,e){this.speed=e,this.stars=Array(t),this.renderProvider=h.getInstance(),this.speed=e,this.init();}isOutOfBounds(t){const{height:e}=this.renderProvider.canvasSize;return t.position.y>e;}init(){for(let t=0;t<this.stars.length;t++){const e=this.createPosition(this.renderProvider.canvasSize);this.stars[t]=new Rs(e,this.speed);}}createPosition({width:t,height:e}){const s=Qt(t),r=Qt(e);return new a(s,r);}followPath(){this.stars.forEach(t=>{t.update(),this.isOutOfBounds(t)&&t.startAgain(t);});}render(){this.stars.forEach(t=>t.render());}}class us extends ri{constructor(t,e,s=d.Dark){super(t),this.position=t,this.size=e,this.color=s;}render(){const{x:t,y:e}=this.position,{width:s,height:r}=this.size;this.renderer.setColor(this.color,()=>{this.renderer.context.fillRect(t,e,s,r);});}}class Ci{constructor(t){const e=h.getInstance();this.rectangle=new us(a.Zero,e.canvasSize,t);}render(){this.rectangle.render();}}const ts=class ts extends ii{constructor(t){super(),this.renderProvider=h.getInstance(),this.position=a.Zero,this.starController=new Cr(ts.QUANTITY_STARS,t),this.background=new Ci(d.Space);}update(){this.starController.followPath();}render(){this.background.render(),this.starController.render();}get width(){return this.renderProvider.canvasSize.width;}get height(){return this.renderProvider.canvasSize.height;}};ts.QUANTITY_STARS=100;let De=ts;class Lt{constructor(){this.implementationIds=new Set,this.renderProvider=h.getInstance();}static getInstance(){return Lt.instance||(Lt.instance=new Lt),Lt.instance;}addListener(t){this.implementationIds.add(t);}removeListener(t){this.implementationIds.delete(t);}hasListener(t){return this.implementationIds.has(t);}update(){this.renderProvider.canvas.style.cursor=this.implementationIds.size>0?"pointer":"default";}}class Ft{constructor(){this._position=a.Zero,this.canvas=h.getInstance().canvas,this.clickListeners=new Map,this.canvas.addEventListener("mousemove",t=>{const e=this.canvas.width/this.canvas.clientWidth,s=this.canvas.height/this.canvas.clientHeight;this._position=new a((t.clientX-this.canvas.offsetLeft)*e,(t.clientY-this.canvas.offsetTop)*s);});}static getInstance(){return Ft.instance||(Ft.instance=new Ft),Ft.instance;}get position(){return this._position;}addClickListener(t,e){this.clickListeners.set(t,e),this.canvas.addEventListener("click",e);}removeClickListener(t){this.clickListeners.has(t)&&(this.canvas.removeEventListener("click",this.clickListeners.get(t)),this.clickListeners.delete(t));}}class te{constructor(t,e,s){this.position=t,this.size=e,this.id=crypto.randomUUID(),this._isHover=!1,this.isDisabled=!1,this.mouseManager=Ft.getInstance(),this.mouseManager.addClickListener(this.id,()=>{this.isHover&&(s(this),$t.MouseClick.play());}),this.cursorMouseManager=Lt.getInstance(),this.toggleSFX=!0;}set padding({left:t=0,right:e=0,top:s=0,bottom:r=0}){this.position.x-=t,this.position.y-=s,this.size.width+=e,this.size.height+=r;}get isHover(){return this._isHover;}removeClickListener(){this.mouseManager.removeClickListener(this.id),this.cursorMouseManager.removeListener(this.id);}checkIsHover(){const t=this.mouseManager.position;this._isHover=!this.isDisabled&&t.x>=this.position.x&&t.x<=this.position.x+this.size.width&&t.y>=this.position.y&&t.y<=this.position.y+this.size.height;}update(){this.checkIsHover(),this.isHover?(this.cursorMouseManager.addListener(this.id),this.toggleSFX&&$t.MouseHover.play(),this.toggleSFX=!1):this.cursorMouseManager.hasListener(this.id)&&(this.cursorMouseManager.removeListener(this.id),this.toggleSFX=!0);}}class xi{constructor(t,e,s){this.size=e,this.textContent=s,this._position=t,this.renderProvider=h.getInstance(),this.centerPosition();}get position(){return this._position;}get x(){return this.position.x;}get y(){return this.position.y;}get right(){return this.x+this.size.width;}get bottom(){return this.y+this.size.height;}get width(){return this.size.width;}get height(){return this.size.height;}centerPosition(){this.textContent.addOffsetAndRememberIt(()=>new a(this.size.width*.5-this.textContent.width*.5,this.size.height*.5));}}const es=class es extends xi{constructor(t,e,s,r,n){super(t,r.value,new p(e,d.Light,r.value.height*es.FONT_SIZE_RATIO_BY_HEIGHT,t.copy())),this.sprites=s.sprites,this.mouseAdapter=new te(t,r.value,()=>n(this)),this.spriteImage=new _({image:this.sprites.base,position:t,size:r.value}),this.opacity=1;}get bottom(){return this.position.y+this.size.height;}get top(){return this.position.y;}get isHover(){return this.mouseAdapter.isHover;}set isDisabled(t){this.mouseAdapter.isDisabled=t;}removeClickListener(){this.mouseAdapter.removeClickListener();}update(){this.mouseAdapter.update(),this.spriteImage.image=this.mouseAdapter.isHover?this.sprites.hover:this.sprites.base,this.textContent.update(),this.opacity=this.mouseAdapter.isDisabled?.5:1;}render(){this.renderProvider.renderer.setOpacity(this.opacity,()=>{this.spriteImage.render(),this.textContent.render();});}};es.FONT_SIZE_RATIO_BY_HEIGHT=.28;let U=es;class H{constructor(t){this.value=t;}static get Small(){return new H(new M(130,58));}static get Medium(){return new H(new M(230,70));}}class x{constructor(t){this.sprites=t;}static get Default(){return new x(c.spriteManager.DEFAULT_BUTTON_SPRITES);}static get Outstanding(){return new x(c.spriteManager.OUTSTANDING_BUTTON_SPRITES);}}const ce=class ce{constructor(t,e,s,r,n){this.button=new U(r,t,s.buttonVariant,H.Medium,o=>{n(o),o.removeClickListener();}),this.text=ce.Description(e,s.descriptionColor,r,this.button);}static Description(t,e,s,r){const n=new p(t,e,14,s.copy());return n.addOffset(new a(r.width*.5,r.height+n.height*.5+ce.VERTICAL_GAP)),n.alignment="center",n;}get height(){return this.text.height;}update(){this.button.update(),this.text.opacity=this.button.isHover?1:.5;}render(){this.button.render(),this.text.render();}};ce.VERTICAL_GAP=20;let Be=ce;class Se{constructor(t,e){this.buttonVariant=t,this.descriptionColor=e;}static get Default(){return new Se(x.Default,d.HighlightedSoftText);}static get Outstanding(){return new Se(x.Outstanding,d.OutstandingText);}}const V=class V{constructor(t,e,s){this.animator=new ft(t,150),this.opacity=V.FOCUS_OPACITY,this.renderer=h.getInstance().renderer,this.spriteImage=new _({image:this.animator.currentFrame,position:a.Zero}),this.spriteImage.position=e.position.sum(a.Horizontal(V.WIDTH*(s+.5)-this.spriteImage.size.width*.5));}get position(){return this.spriteImage.position;}get width(){return this.spriteImage.size.width;}blur(){this.opacity=V.BLUR_OPACITY;}focus(){this.opacity=V.FOCUS_OPACITY;}update(){this.animator.update(),this.spriteImage.image=this.animator.currentFrame;}render(){this.renderer.setOpacity(this.opacity,()=>{this.spriteImage.render();});}};V.WIDTH=68,V.HEIGHT=63,V.ANIMATION_INTERVAL_RATIO=.5,V.FOCUS_OPACITY=1,V.BLUR_OPACITY=.5;let Dt=V;class xr extends wt{constructor(t,e,s){super(t.position.copy(),s[0],1.3),this.gap=e,this.animator=new ft(s,120),this.adjustPosition(t);}adjustPosition(t){this._spriteImage.position=t.position.sum(new a(-this.width*.5+t.width*.5,t.height*.5+this.gap));}update(){this.animator.update(),this._spriteImage.image=this.animator.currentFrame;}render(){this._spriteImage.render();}}class R extends Ni{constructor(t){super(),this.value=t;}getValue(){return this.value;}setValue(t){this.value=t;}}class Fr{constructor(t,e,s){this.maxLength=s,this.display=new p(new R(this.getDisplay(t)),d.Light,23,e),this._value=t;}getDisplay(t){const e=Array.from({length:this.maxLength}).fill("_");return t.split("").forEach((s,r)=>e[r]=s),e.join(" ");}syncDisplay(){this.display.content.setValue(this.getDisplay(this._value));}get width(){return this.display.width;}get value(){return this._value;}get isLimitReached(){return this.value.length>=this.maxLength;}append(t){this._value+=t,this.syncDisplay();}delete(){this._value=this.value.substring(0,this.value.length-1),this.syncDisplay();}addOffset(t){this.display.addOffset(t);}render(){this.display.render();}}class Dr{constructor(t,e,s){const{key:r,keyVariant:n}=t;this.allSprites=n.sprites,this.spriteImage=new _({image:n.sprites.base,position:e}),this.mouseAdapter=new te(e,this.spriteImage.size,()=>s(r)),this.text=new p(new R(r),d.Light,n.fontSize,e.copy()),this.text.addOffset(new a(this.spriteImage.size.width*.5-this.text.width*.5,this.spriteImage.size.height*.5));}get position(){return this.spriteImage.position;}get width(){return this.spriteImage.size.width;}get height(){return this.spriteImage.size.height;}addOffset(t){this.spriteImage.position.x+=t.x,this.spriteImage.position.y+=t.y,this.text.addOffset(t);}update(){this.mouseAdapter.update(),this.spriteImage.image=this.mouseAdapter.isHover?this.allSprites.hover:this.allSprites.base;}render(){this.spriteImage.render(),this.text.render();}}class It{constructor(t,e){this.sprites=t,this.fontSize=e;}static get Default(){return new It(c.spriteManager.KEYBOARD_INPUT_KEY_DEFAULT,18);}static get Outstanding(){return new It(c.spriteManager.KEYBOARD_INPUT_KEY_OUTSTANDING,18);}static get OutstandingLarge(){return new It(c.spriteManager.KEYBOARD_INPUT_KEY_OUTSTANDING_LARGE,12);}}const st=class st{constructor(t,e){this.display=e,this.keys=this.getKeys([...this.getKeyDataInRange(97,122,It.Default),...this.getKeyDataInRange(48,57,It.Outstanding),{key:".",keyVariant:It.Outstanding},{key:"Backspace",keyVariant:It.OutstandingLarge}],t),this.adjustPosition();}getKeyDataInRange(t,e,s){const r=[];for(let n=t;n<=e;n++)r.push({key:String.fromCharCode(n),keyVariant:s});return r;}calculateWidth(){const t=this.keys[0],e=this.keys[st.KEY_BY_ROW-1];return e.position.x+e.width-t.position.x;}getKeys(t,e){let s=e.x,r=e.y;return t.map((o,l)=>{const I=l+1,m=new Dr(o,new a(s,r),_t=>this.editDisplay(_t));return I%st.KEY_BY_ROW!==0?s+=m.width+st.GAP:(s=e.x,r+=m.height+st.GAP),m;});}editDisplay(t){t==="Backspace"?this.display.delete():this.display.isLimitReached||this.display.append(t);}adjustPosition(){const t=this.calculateWidth(),e=a.Horizontal(-t*.5);this.keys.forEach(s=>s.addOffset(e));}get right(){const t=this.keys[st.KEY_BY_ROW-1];return t.position.x+t.width;}update(){this.keys.forEach(t=>t.update());}render(){this.keys.forEach(t=>t.render());}};st.GAP=15,st.KEY_BY_ROW=13;let vs=st;class ie{constructor(t,e,s,r){e=e.substring(0,r),this.backToSceneButton=new C(()=>s(e)),this.title=ie.Title(t),this.display=ie.Display(e,r);const n=h.getInstance();this.virtualKeyboard=new vs(n.getPositionByScreen(.5,.4),this.display),this.continueButton=ie.ContinueButton(s,this.display,this.virtualKeyboard);}static Title(t){const e=h.getInstance(),s=new p(new g(t),d.Highlighted,22,e.getPositionByScreen(.5,.2));return s.addOffset(a.Horizontal(-s.width*.5)),s;}static Display(t,e){const s=h.getInstance(),r=new Fr(t,s.getPositionByScreen(.5,.28),e);return r.addOffset(a.Horizontal(-r.width*.5)),r;}static ContinueButton(t,e,s){const r=P.getInstance(),n=220;return new U(new a(s.right-n,h.getInstance().getMeasureByScreenHeight(.72)),new g("keyboard.text.continue"),x.Default,new H(new M(n,70)),o=>{r.changeScene(t(e.value)),o.removeClickListener();});}update(){this.backToSceneButton.update(),this.virtualKeyboard.update(),this.continueButton.update();}render(){this.backToSceneButton.render(),this.title.render(),this.display.render(),this.virtualKeyboard.render(),this.continueButton.render();}}class Br extends wt{constructor(t){const e=c.spriteManager.EDIT_ICON;super(t,e.base),this.icons=e,this.isActive=!1;}addOffset(t){this._spriteImage.position=this._spriteImage.position.sum(t);}update(){this._spriteImage.image=this.isActive?this.icons.active:this.icons.base;}render(){this._spriteImage.render();}}const j=class j{constructor(t,e,s,r,n){this.hasValue=r.getValue().length>0;const o=t.height+e;this.icon=j.Icon(t,o),this.text=j.Text(this.hasValue?r:s,t,this.icon,o),this.centerAllComponents(t),this.mouseAdapter=j.MouseAdapter(this.icon,new M(this.calculateWidth(),this.height),r.getValue(),n);}static Icon(t,e){return new Br(t.position.sum(a.Vertical(e)));}static Text(t,e,s,r){const n=new p(t,d.Light,14,e.position.copy()),o=new a(s.width+j.GAP,r+n.height*.5);return n.addOffset(o),n;}static MouseAdapter(t,e,s,r){const n=P.getInstance(),o=new te(t.position.copy(),e,l=>{l.removeClickListener(),n.changeScene(new ie("nickname_card_input.input",s,r,u.PLAYER_NICKNAME_MAX_LENGTH));});return o.padding={left:4,right:14,top:8,bottom:12},o;}calculateWidth(){return this.icon.width+this.text.width+j.GAP;}get height(){return Math.max(this.icon.height,this.text.height);}centerAllComponents(t){const e=a.Horizontal(t.width*.5-this.calculateWidth()*.5);this.icon.addOffset(e),this.text.addOffset(e);}update(){this.icon.isActive=this.mouseAdapter.isHover,this.icon.update(),this.mouseAdapter.update(),this.text.opacity=this.hasValue?1:j.PLACEHOLDER_OPACITY;}render(){this.icon.render(),this.text.render();}};j.PLACEHOLDER_OPACITY=.25,j.GAP=15;let Cs=j;const de=class de{constructor(t,e,s,r){this.title=p.DefaultSize(new g(t.title),d.Light,e),this.character=new xr(this.title,de.VERTICAL_GAP,t.sprites),this.input=new Cs(this.character,de.VERTICAL_GAP,t.placeholder,s,r);}update(){this.character.update(),this.input.update();}render(){this.title.render(),this.character.render(),this.input.render();}};de.VERTICAL_GAP=25;let He=de;class fe{constructor(t,e,s){this.title=t,this.sprites=e,this.placeholder=s;}static get PlayerOne(){return new fe("player_text_abbreviation.first",c.spriteManager.NPC_SHIP_ONE,new g("offline_multiplayer_nickname_menu_scene.first_player.default_name"));}static get PlayerTwo(){return new fe("player_text_abbreviation.second",c.spriteManager.NPC_SHIP_TWO,new g("offline_multiplayer_nickname_menu_scene.second_player.default_name"));}}const b=class b{};b.MOVEMENT_SPEED=11.5,b.IDLE_ANIMATION_INTERVAL=350,b.MOVING_ANIMATION_INTERVAL=140,b.COLLIDER_RADIUS=25,b.PLAYER_SPAWN_PIVOT_POSITION_X_IN_SCREEN=.5,b.PLAYER_SPAWN_DISTANCE_TO_PIVOT_POSITION_X_IN_SCREEN=.1,b.PLAYER_SPAWN_POSITION_Y_IN_SCREEN=.75,b.INVINCIBILITY_OSCILLATIONS=3,b.INVINCIBILITY_OSCILLATION_INTERVAL=200;let S=b;class Hr{constructor(t,e,s,r){this.position=t,this.playerControls=s;const n=h.getInstance().canvasSize.width;this.boundary=n-e,this.gameControlProvider=J.getInstance(),this.idleAnimator=new ft(r.idle,S.IDLE_ANIMATION_INTERVAL),this.movingAnimator=new ft(r.moving,S.MOVING_ANIMATION_INTERVAL),this.isMoving=!1;}update(){this.isMoving=!1,this.moveLeft(),this.moveRight(),this.animator.update();}get currentFrameAnimation(){return this.animator.currentFrame;}reachLeftBoundary(){return this.position.x-S.MOVEMENT_SPEED>0;}reachRightBoundary(){return this.position.x+S.MOVEMENT_SPEED<=this.boundary;}moveLeft(){this.gameControlProvider.hasPulsed(this.playerControls.left)&&(this.isMoving=!0,this.reachLeftBoundary()&&(this.position.x-=S.MOVEMENT_SPEED));}moveRight(){this.gameControlProvider.hasPulsed(this.playerControls.right)&&(this.isMoving=!0,this.reachRightBoundary()&&(this.position.x+=S.MOVEMENT_SPEED));}get animator(){return this.isMoving?this.movingAnimator:this.idleAnimator;}}class kr{constructor(){this.left=f.LeftPlayerOne,this.right=f.RightPlayerOne,this.fire=f.FirePlayerOne;}}class Yr{constructor(t,e){this.playerControls=t,this.generateLaser=e,this.gameControlProvider=J.getInstance(),this.laserController=Ot.getInstance(),this.refireTimer=new N(()=>this.refireTimer.stop(),u.PLAYER_FIRE_RATIO_IN_MS),this.timer=new N(()=>this.fire(),u.PLAYER_FIRE_RATIO_IN_MS),this.hasPulsedFireButtonForFirstTime=!1;}update(){this.checkFireRatio();}canStartFire(){return this.hasPulsedFireButton()&&this.hasPulsedFireButtonForFirstTime&&this.refireTimer.isStopped;}fireButtonHasReleased(){return!this.hasPulsedFireButton()&&!this.hasPulsedFireButtonForFirstTime;}startFire(){this.refireTimer.start(),this.fire(),this.timer.start(),this.hasPulsedFireButtonForFirstTime=!1;}resetFireInitialState(){this.timer.stop(),this.hasPulsedFireButtonForFirstTime=!0;}checkFireRatio(){this.refireTimer.update(),this.timer.update(),this.canStartFire()?this.startFire():this.fireButtonHasReleased()&&this.resetFireInitialState();}fire(){this.laserController.generate(this.generateLaser()),$t.PlayerFire.play();}hasPulsedFireButton(){return this.gameControlProvider.hasPulsed(this.playerControls.fire);}}class Vr{constructor(){this._isInvincible=!1,this._isVisible=!0,this.oscillations=S.INVINCIBILITY_OSCILLATIONS,this.timer=new N(()=>this.oscillate(),S.INVINCIBILITY_OSCILLATION_INTERVAL);}get isInvincible(){return this._isInvincible;}get isVisible(){return this._isVisible;}makeInvincibility(){this._isInvincible=!0,this.oscillations=S.INVINCIBILITY_OSCILLATIONS,this.timer.start();}undoInvincibility(){this._isInvincible=!1,this.timer.stop();}invincibilityHasFinished(){return this.oscillations===0&&this._isVisible;}oscillate(){if(this.invincibilityHasFinished()){this.undoInvincibility();return;}this._isVisible=!this._isVisible,this._isVisible&&this.oscillations--;}update(){this.timer.update();}}class br{constructor(){this.left=f.LeftPlayerTwo,this.right=f.RightPlayerTwo,this.fire=f.FirePlayerTwo;}}class Te{constructor(t){this.sprite=t;}static get One(){return new Te(c.spriteManager.SHIP_ONE.laser);}static get Two(){return new Te(c.spriteManager.SHIP_TWO.laser);}}class Gr extends Ai{constructor(t,e){super(u.PLAYER_LASER_TAG,u.PLAYER_LASER_SPEED,z.Forward,e.sprite,t);}}const ut=class ut extends wt{constructor({id:t,sprites:e,controls:s,position:r,laserCharacter:n,lifes:o}){super(r,e.moving[0]),this.id=t,this.sprites=e,this.controls=s,this.laserCharacter=n,this._lifes=o,this.movementController=new Hr(r,this.width,s,e),this.fireController=new Yr(s,()=>new Gr(r.sum(a.Horizontal(this.width*.5)),n)),this.addOffsetX(r),this.collider=new ls(this,S.COLLIDER_RADIUS),this.invincibleController=new Vr,this.initialPosition=r.copy(),this.explosionEffectManager=D.getInstance();}static PlayerOne(t,e){const s=c.spriteManager;return new ut({id:ut.PLAYER_ONE_ID,sprites:s.SHIP_ONE,controls:new kr,position:t,laserCharacter:Te.One,lifes:e});}static PlayerTwo(t,e){const s=c.spriteManager;return new ut({id:ut.PLAYER_TWO_ID,sprites:s.SHIP_TWO,controls:new br,position:t,laserCharacter:Te.Two,lifes:e});}addOffsetX(t){t.x-=this.width*.5;}update(){this.isDead||(this._spriteImage.image=this.movementController.currentFrameAnimation,this.movementController.update(),this.fireController.update(),this.invincibleController.isInvincible&&this.invincibleController.update());}render(){this.isDead||this.invincibleController.isVisible&&this._spriteImage.render();}damage(){if(this.isDead){this.explosionEffectManager.play(this,!1);return;}this._lifes--,this.invincibleController.makeInvincibility();}resetPosition(){this._spriteImage.position.x=this.initialPosition.x,this._spriteImage.position.y=this.initialPosition.y;}incrementLifes(){this._lifes+=u.WINNING_PLAYER_LIFE_INCREMENT;}kill(){this._lifes=0;}get isInvincible(){return this.invincibleController.isInvincible;}get isDead(){return this._lifes<=0;}get lifes(){return this._lifes;}};ut.PLAYER_ONE_ID="P1",ut.PLAYER_TWO_ID="P2";let Ut=ut;const ss=class ss extends wt{constructor(t,e){super(t,e,ss.PLAYER_SELECTOR_SCALE);}set position(t){this._spriteImage.position=t;}update(){}render(){this._spriteImage.render();}};ss.PLAYER_SELECTOR_SCALE=.5;let xs=ss;const gt=class gt{constructor(t,e){this.player=t,this.nickname=new p(new R(e),d.PlayerHUD,gt.FONT_SIZE,a.Zero),this.selector=new xs(a.Zero,c.spriteManager.PLAYER_SELECTOR);}adjustFigurePositions(){const t=this.player.width*.5;this.selector.position=this.player.position.sum(new a(t-this.selector.width*.5,-gt.SELECTOR_GAP)),this.nickname.position=this.player.position.sum(new a(t-this.nickname.width*.5,this.player.height+gt.NAME_GAP));}update(){this.adjustFigurePositions(),this.selector.update();}render(){this.nickname.render(),this.selector.render();}};gt.NAME_GAP=13,gt.SELECTOR_GAP=17,gt.FONT_SIZE=11;let Fs=gt;class Si extends Ut{constructor(t,e){super({id:t.id,sprites:t.sprites,controls:t.controls,position:t.position,laserCharacter:t.laserCharacter,lifes:t.lifes}),this.nickname=e,this.displayPlayerFigure=new Fs(t,e);}shouldSkipRendering(){return this.isDead||this.nickname.length===0;}update(){super.update(),!this.shouldSkipRendering()&&this.displayPlayerFigure.update();}render(){super.render(),!this.shouldSkipRendering()&&this.displayPlayerFigure.render();}}var Fi=(i=>(i[i.Medium=12]="Medium",i[i.Big=14]="Big",i))(Fi||{});const fi=Fi;class Nt{constructor(t,e){this.enemyHordQuantityRows=e,this.players=new Map(t.map(s=>[s.id,s]));}static Individual(){const t=h.getInstance();return new Nt([Ut.PlayerOne(t.getPositionByScreen(S.PLAYER_SPAWN_PIVOT_POSITION_X_IN_SCREEN,S.PLAYER_SPAWN_POSITION_Y_IN_SCREEN),u.INDIVIDUAL_PLAYER_LIFES)],fi.Medium);}static Multiplayer(t){const e=h.getInstance();return new Nt([new Si(Ut.PlayerOne(e.getPositionByScreen(S.PLAYER_SPAWN_PIVOT_POSITION_X_IN_SCREEN-S.PLAYER_SPAWN_DISTANCE_TO_PIVOT_POSITION_X_IN_SCREEN,S.PLAYER_SPAWN_POSITION_Y_IN_SCREEN),u.MULTIPLAYER_PLAYER_LIFES),t.playerOne),new Si(Ut.PlayerTwo(e.getPositionByScreen(S.PLAYER_SPAWN_PIVOT_POSITION_X_IN_SCREEN+S.PLAYER_SPAWN_DISTANCE_TO_PIVOT_POSITION_X_IN_SCREEN,S.PLAYER_SPAWN_POSITION_Y_IN_SCREEN),u.MULTIPLAYER_PLAYER_LIFES),t.playerTwo)],fi.Big);}update(){this.forEachPlayer(t=>t.update());}render(){this.forEachPlayer(t=>t.render());}forEachPlayer(t){this.players.forEach(t);}get noPlayers(){return Array.from(this.players.values()).every(({isDead:e})=>e);}}class Bt{constructor(t){this.backToMainMenuButton=C.BackToOfflineGameModeMenuButton();const e=h.getInstance(),s=.32;this.nicknameCards=[new He(fe.PlayerOne,e.getPositionByScreen(.33,s),new R(t.playerOne),r=>new Bt({...t,playerOne:r})),new He(fe.PlayerTwo,e.getPositionByScreen(.63,s),new R(t.playerTwo),r=>new Bt({...t,playerTwo:r}))],this.playButton=Bt.PlayButton(t);}static Initial(){return new Bt({playerOne:"",playerTwo:""});}static PlayButton(t){const e=h.getInstance(),s=H.Medium,r=B.getInstance();return new U(e.getPositionByScreen(.5,.72).diff(a.Horizontal(s.value.width*.5)),new g("offline_multiplayer_nickname_menu_scene.button.play"),x.Outstanding,s,n=>{n.removeClickListener(),r.changeScene(Tt.Initial(Nt.Multiplayer(t)));});}update(){this.backToMainMenuButton.update(),this.nicknameCards.forEach(t=>t.update()),this.playButton.update();}render(){this.backToMainMenuButton.render(),this.nicknameCards.forEach(t=>t.render()),this.playButton.render();}}class Kt{constructor(t){this.sprites=t;}static get PlayerOne(){return new Kt(c.spriteManager.NPC_SHIP_ONE);}static get SecondOne(){return new Kt(c.spriteManager.NPC_SHIP_TWO);}}const it=class it{constructor(t,e,s,r,n){this.direction=e,this.shipVariants=n,this.button=new U(t,s,x.Default,H.Medium,o=>{r(o),o.removeClickListener();}),this.ships=n.map((o,l)=>new Dt(o.sprites,this.button,l)),this.adjustShipPosition(this.button,e);}static Invidual(t){const e=B.getInstance();return new it(t,z.Backward,new g("offline_game_mode_menu_scene.button.singleplayer"),()=>e.changeScene(Tt.Initial(Nt.Individual())),[Kt.PlayerOne]);}static Multiplayer(t){const e=P.getInstance();return new it(t,z.Forward,new g("offline_game_mode_menu_scene.button.multiplayer"),()=>e.changeScene(Bt.Initial()),[Kt.PlayerOne,Kt.SecondOne]);}get height(){return Dt.HEIGHT;}adjustShipPosition(t,e){const s=t.width*.5-this.calculateShipGroupWidth()*.5,r=(t.height*.5+Dt.HEIGHT*.5+it.VERTICAL_GAP)*e;this.ships.forEach((n,o)=>{n.position.x+=s,n.position.y+=r,o>0&&(n.position.x+=it.HORIZONTAL_GAP);});}calculateShipGroupWidth(){const t=it.HORIZONTAL_GAP*(this.ships.length-1);return this.ships.reduce(e=>e+Dt.WIDTH,0)+t;}update(){this.button.update(),this.ships.forEach(t=>{t.update(),this.button.isHover?t.focus():t.blur();});}render(){this.button.render(),this.ships.forEach(t=>t.render());}};it.VERTICAL_GAP=60,it.HORIZONTAL_GAP=30;let ke=it;class li{constructor(){this.backToMainMenuButton=C.BackToGameModeMenuScene();const t=h.getInstance();this.modeButtons=[ke.Invidual(t.getPositionByScreen(.24,.3)),ke.Multiplayer(t.getPositionByScreen(.55,.7))];}update(){this.backToMainMenuButton.update(),this.modeButtons.forEach(t=>t.update());}render(){this.backToMainMenuButton.render(),this.modeButtons.forEach(t=>t.render());}}class Di{constructor(){this.backToMainMenuButton=C.BackToMainMenuButton();const t=h.getInstance(),e=P.getInstance();this.gameModeButtons=[new Be(new g("game_mode_menu_scene.button.offline"),new g("game_mode_menu_scene.button.offline_text"),Se.Default,t.getPositionByScreen(.24,.4),()=>e.changeScene(new li)),new Be(new g("game_mode_menu_scene.button.online"),new g("game_mode_menu_scene.button.online_text"),Se.Outstanding,t.getPositionByScreen(.55,.4),()=>alert("Soy modo online..."))];}update(){this.backToMainMenuButton.update(),this.gameModeButtons.forEach(t=>t.update());}render(){this.backToMainMenuButton.render(),this.gameModeButtons.forEach(t=>t.render());}}class C extends U{constructor(t){const e=P.getInstance(),s=H.Small;super(C.calculatePosition(s.value),new g("button.back"),x.Default,s,r=>{r.removeClickListener(),e.changeScene(t());});}static BackToGameModeMenuScene(){return new C(()=>new Di);}static BackToMainMenuButton(){return new C(()=>new ki);}static BackToOfflineGameModeMenuButton(){return new C(()=>new li);}static calculatePosition(t){const{canvasSize:e}=h.getInstance();return new a(e.width*.08-t.width*.5,e.height*.09-t.height*.5);}}const y=class y extends xi{constructor(t,e,s,r,n){super(t,e,new p(new R(s),d.Dark,e.height*n,t.copy())),this.sprite=r,this.spriteImage=new _({image:r,position:t,size:e});}static NewLargeSize(){return new M(y.CONTROL_LARGE_SIZE,y.CONTROL_SQUARE_SIZE);}static NewSmallSize(){return new M(y.CONTROL_SQUARE_SIZE,y.CONTROL_SQUARE_SIZE);}static Large(t,e){const s=c.spriteManager.KEY_SPRITES.large;return new y(t,y.NewLargeSize(),e,s,.3);}static Small(t,e){const s=c.spriteManager.KEY_SPRITES.small;return new y(t,y.NewSmallSize(),e,s,.5);}static SmallWithWord(t,e){const s=c.spriteManager.KEY_SPRITES.small;return new y(t,y.NewSmallSize(),e,s,.3);}render(){this.spriteImage.render(),this.textContent.render();}};y.CONTROL_SQUARE_SIZE=75,y.CONTROL_LARGE_SIZE=200;let lt=y;class W extends p{constructor(t,e){super(t,d.Highlighted,p.DEFAULT_FONT_SIZE,e);}static PlayerCaption(t,e){return new W(t,e);}static Fire(t){return W.PlayerCaption(new g("controls_scene.text.fire"),t);}static Move(t){return W.PlayerCaption(new g("controls_scene.text.move"),t);}static Navigation(t,e){const s=new W(t,new a(e.position.x,e.bottom));return s.addOffsetAndRememberIt(()=>a.Horizontal(e.width*.5-s.width*.5)),s;}static Pause(t){return W.Navigation(new g("controls_scene.text.pause"),t);}static Exit(t){return W.Navigation(new g("controls_scene.text.exit"),t);}}const pt=class pt{constructor(t,e){this.caption=t,this.key=e,t.addOffsetAndRememberIt(()=>a.Vertical(pt.GAP));}static PauseKey(){const t=h.getInstance(),e=lt.Large(t.getPositionByScreen(.4,.7),"backspace");return new pt(W.Pause(e),e);}static ExitKey(t){const e=lt.SmallWithWord(new a(t.key.position.x+t.key.width+pt.GAP_BETWEEN_CONTROL_KEYS,t.key.position.y),"esc");return new pt(W.Exit(e),e);}update(){this.caption.update();}render(){this.key.render(),this.caption.render();}};pt.GAP=30,pt.GAP_BETWEEN_CONTROL_KEYS=50;let Ye=pt;const F=class F{constructor(t,e,s){this.title=new p(t,d.Highlighted,40,s),this.title.addOffset(a.Horizontal(-this.title.width*.5)),this.fireKey=lt.Small(this.calculateFireKeyPosition(),e.fire);const r=this.fireKey.bottom+F.MOVING_KEY_GAP;this.leftKey=lt.Small(new a(this.fireKey.x-this.fireKey.width-F.MOVING_KEY_GAP,r),e.left),this.rightKey=lt.Small(new a(this.fireKey.right+F.MOVING_KEY_GAP,r),e.right),this.centerKey=lt.Small(new a(this.fireKey.x,r),"");}get width(){return this.rightKey.right-this.leftKey.x;}get x(){return this.leftKey.x;}get right(){return this.rightKey.right;}get fireKeyCenterY(){return this.fireKey.y+this.fireKey.width*.5;}get centerKeyCenterY(){return this.centerKey.y+this.centerKey.width*.5;}get y(){return this.title.position.y;}static PlayerOneGroup(t){return new F(new g("player_text_abbreviation.first"),{right:"d",left:"a",fire:"w"},t);}static PlayerTwoGroup(t){return new F(new g("player_text_abbreviation.second"),{right:"",left:"",fire:""},new a(t.right+t.width*.5+F.GAP_BETWEEN_GROUPS,t.y));}calculateFireKeyPosition(){const t=this.title.width*.5-lt.CONTROL_SQUARE_SIZE*.5,e=this.title.height+F.TITLE_TO_PIVOT_KEY_GAP;return new a(this.title.position.x+t,this.title.position.y+e);}render(){this.fireKey.render(),this.leftKey.render(),this.rightKey.render(),this.centerKey.render(),this.title.render();}};F.MOVING_KEY_GAP=15,F.TITLE_TO_PIVOT_KEY_GAP=15,F.GAP_BETWEEN_GROUPS=70;let Ve=F;const le=class le{constructor(){const t=h.getInstance(),e=Ve.PlayerOneGroup(t.getPositionByScreen(.44,.22));this.playerControlKeyGroupList=[e,Ve.PlayerTwoGroup(e)],this.controlCaptions=le.ControlCaptions(e);}static ControlCaptions(t){const e=[W.Fire(new a(t.x,t.fireKeyCenterY)),W.Move(new a(t.x,t.centerKeyCenterY))],s=Math.max(...e.map(r=>r.width));return e.forEach(r=>{r.addOffset(a.Horizontal(-s-le.GAP));}),e;}render(){this.playerControlKeyGroupList.forEach(t=>t.render()),this.controlCaptions.forEach(t=>t.render());}};le.GAP=70;let Ds=le;class Wr{constructor(){const t=Ye.PauseKey();this.navigationControlsKey=[t,Ye.ExitKey(t)],this.playerControlKeys=new Ds,this.backToMainMenuButton=C.BackToMainMenuButton();}update(){this.backToMainMenuButton.update(),this.navigationControlsKey.forEach(t=>t.update());}render(){this.backToMainMenuButton.render(),this.navigationControlsKey.forEach(t=>t.render()),this.playerControlKeys.render();}}class zr extends U{constructor(t,e){super(e.getNewButtonPosition(new a(t.x,t.bottom)),new g("main_menu_scene.button.control"),x.Default,H.Medium,()=>{this.removeClickListener(),this.action();}),this.gameMenuSceneManager=P.getInstance();}action(){this.gameMenuSceneManager.changeScene(new Wr);}}const rt=class rt{};rt.CONTRIBUITOR_VERTICAL_SCROLLING_SPEED=6,rt.OVERLAY_EXPANSION_SPEED=35,rt.SHIP_SPEED_TARGET=2.5,rt.SHIP_TWO_SPEED_TARGET=10,rt.SHIP_TWO_DECELERATION=.065,rt.SHIP_ONE_MOVEMENT_DATA=Object.freeze({speed:2.5,speedTarget:2.5,deceleration:0}),rt.SHIP_TWO_MOVEMENT_DATA=Object.freeze({speed:10,speedTarget:2.5,deceleration:.065});let Rt=rt;class ui{constructor(t,e){this._expanded=!1,this.renderProvider=h.getInstance(),this.rectangle=new us(new a(this.renderProvider.halfScreenWidth,this.renderProvider.getMeasureByScreenHeight(t)),new M(0,this.renderProvider.getMeasureByScreenHeight(e)),d.Overlay);}get y(){return this.rectangle.position.y;}get centerY(){return this.y+this.rectangle.size.height*.5;}get expanded(){return this._expanded;}expand(){const t=Rt.OVERLAY_EXPANSION_SPEED,{position:e,size:s}=this.rectangle;if(e.x===0&&s.width===this.renderProvider.canvasSize.width){this._expanded=!0;return;}if(e.x-t<=0&&s.width+t*2>=this.renderProvider.canvasSize.width){e.x=0,s.width=this.renderProvider.canvasSize.width;return;}e.x-=t,s.width+=t*2;}render(){this.rectangle.render();}}const Gt=class Gt{constructor(t,e,s){this._hasPassedScreen=!1,this.renderProvider=h.getInstance();const r=new ft(t.idle,S.MOVING_ANIMATION_INTERVAL*Gt.ANIMATION_INTERVAL_RATIO);this.idleAnimator=r,this.movingAnimator=new ft(t.moving,r.interval),this.animator=this.idleAnimator,this.speed=s.speed,this.speedTarget=s.speedTarget,this.deceleration=s.deceleration,this.spriteImage=new _({image:this.animator.currentFrame,position:e});}static OneShip(t,e){return new Gt(c.spriteManager.SHIP_ONE,t,e);}static TwoShip(t,e){return new Gt(c.spriteManager.SHIP_TWO,t,e);}get hasPassedScreen(){return this._hasPassedScreen;}get bottom(){return this.spriteImage.position.y+this.height;}get height(){return this.spriteImage.size.height;}decelerate(){this.speed=Math.max(this.speedTarget,this.speed-this.deceleration);}updateAnimator(){this.animator=this.speed<=0?this.idleAnimator:this.movingAnimator,this.animator.update();}update(){if(this.spriteImage.position.y<=this.renderProvider.getMeasureByScreenHeight(-.1)){this._hasPassedScreen=!0;return;}this.decelerate(),this.updateAnimator(),this.spriteImage.position.y-=this.speed,this.spriteImage.image=this.animator.currentFrame;}render(){this.hasPassedScreen||this.spriteImage.render();}};Gt.ANIMATION_INTERVAL_RATIO=.72;let qt=Gt;class Ur{constructor(){const t=h.getInstance();this.shipOne=qt.OneShip(new a(t.getMeasureByScreenWidth(.28),t.canvasSize.height),Rt.SHIP_ONE_MOVEMENT_DATA),this.shipTwo=qt.TwoShip(t.getPositionByScreen(.72,1.2),Rt.SHIP_TWO_MOVEMENT_DATA),this.ships=[this.shipOne,this.shipTwo],this.renderProvider=t;}get hasPassedScreen(){return this.ships.every(t=>t.hasPassedScreen);}shipTwoCanNowMoveForward(){return this.shipOne.bottom<=this.renderProvider.getMeasureByScreenHeight(.6);}forward(){this.shipOne.update(),this.shipTwoCanNowMoveForward()&&this.shipTwo.update();}render(){this.shipOne.render(),this.shipTwo.render();}}const Kr=[{workAreaId:"credit_scene.text.ui_design",contribuitors:[{name:"Manuel Rivera",social:"github@LeunknownR"},{name:"Mario Roy",social:"instagram@hicor13"}]},{workAreaId:"credit_scene.text.game_design",contribuitors:[{name:"Manuel Rivera",social:"github@LeunknownR"}]},{workAreaId:"credit_scene.text.programming",contribuitors:[{name:"Manuel Rivera",social:"github@LeunknownR"},{name:"Ausubel Velasquez",social:"github@avelasquez"},{name:"Jose Fuilco",social:"github@josefuilco"}]},{workAreaId:"credit_scene.text.soundtrack",contribuitors:[{name:"Josu Martinez",social:"instagram@gcore.2157"}]}],ue=class ue extends p{constructor(t,e){super(ue.getContribuitorFullname(t),d.Light,ue.CONTRIBUITOR_FONT_SIZE,e),this.addOffset(a.Horizontal(-this.width*.5));}static getContribuitorFullname(t){return new R(`${t.name} (${t.social})`);}};ue.CONTRIBUITOR_FONT_SIZE=16;let Bs=ue;const Et=class Et{constructor(t,e,s){this.renderProvider=h.getInstance(),this.title=new p(t,d.Highlighted,Et.TITLE_FONT_SIZE,new a(this.renderProvider.getMeasureByScreenWidth(.5),s)),this.title.addOffset(new a(-this.title.width*.5,this.title.height*.5)),this.contribuitors=this.toContribuitorTextContent(e,this.title);}toContribuitorTextContent(t,e){const s=[];let r=new a(this.renderProvider.getMeasureByScreenWidth(.5),e.position.y+e.height+Et.TITLE_MARGIN_BOTTOM);return t.forEach(n=>{const o=new Bs(n,r.copy());s.push(o),r=r.sum(a.Vertical(o.height+Et.GAP_BETWEEN_CONTRIBUITORS));}),s;}get y(){return this.title.position.y;}get bottom(){const t=this.contribuitors[this.contribuitors.length-1];return t.position.y+t.height;}addOffset(t){this.title.addOffset(t),this.contribuitors.forEach(e=>{e.addOffset(t);});}render(){this.title.render(),this.contribuitors.forEach(t=>t.render());}};Et.TITLE_MARGIN_BOTTOM=20,Et.GAP_BETWEEN_CONTRIBUITORS=15,Et.TITLE_FONT_SIZE=20;let Hs=Et;const ge=class ge{constructor(t){this.overlayBackground=t,this._scrollingHasFinished=!1,this.renderProvider=h.getInstance(),this.creditWorkAreas=ge.WorkAreas(this.renderProvider),this.verticalScrollLimit=this.calculateVerticalScrollLimit();}calculateVerticalScrollLimit(){const e=this.creditWorkAreas[this.creditWorkAreas.length-1].bottom-this.renderProvider.canvas.height;return this.overlayBackground.centerY-e*.5;}static WorkAreas(t){const e=[];let s=t.canvasSize.height;return Kr.forEach(({workAreaId:r,contribuitors:n},o,{length:l})=>{const I=new Hs(new g(r),n,s);e.push(I),s=I.bottom,o===l-1||(s+=ge.GAP_BETWEEN_WORK_AREAS);}),e;}scrollVertically(t){this.creditWorkAreas.forEach(e=>{e.addOffset(a.Vertical(-t));});}get scrollingHasFinished(){return this._scrollingHasFinished;}scrollUp(){const t=this.creditWorkAreas[0].y;if(t===this.verticalScrollLimit){this._scrollingHasFinished=!0;return;}const s=t-Rt.CONTRIBUITOR_VERTICAL_SCROLLING_SPEED<=this.verticalScrollLimit?t-this.verticalScrollLimit:Rt.CONTRIBUITOR_VERTICAL_SCROLLING_SPEED;this.scrollVertically(s);}forEachWorkArea(t){this.creditWorkAreas.forEach(t);}render(){this.forEachWorkArea(t=>t.render());}};ge.GAP_BETWEEN_WORK_AREAS=25;let ks=ge;class Zr{constructor(){this.overlayBackground=new ui(.2,.72),this.creditWorkAreaGroup=new ks(this.overlayBackground),this.ships=new Ur;}update(){if(!this.ships.hasPassedScreen){if(this.overlayBackground.expanded){this.ships.forward();return;}if(this.creditWorkAreaGroup.scrollingHasFinished){this.overlayBackground.expand();return;}this.creditWorkAreaGroup.scrollUp();}}render(){this.ships.render(),this.overlayBackground.render(),this.creditWorkAreaGroup.render();}}class Xr{constructor(){this.backToMainMenuButton=C.BackToMainMenuButton(),this.creditContribuitorsGroup=new Zr;}update(){this.backToMainMenuButton.update(),this.creditContribuitorsGroup.update();}render(){this.backToMainMenuButton.render(),this.creditContribuitorsGroup.render();}}class jr extends U{constructor(t,e){super(e.getNewButtonPosition(new a(t.x,t.bottom)),new g("main_menu_scene.button.credit"),x.Outstanding,H.Medium,()=>{this.removeClickListener(),this.action();}),this.gameMenuSceneManager=P.getInstance();}action(){this.gameMenuSceneManager.changeScene(new Xr);}}class $r extends U{constructor(t,e){const s=h.getInstance(),r=H.Medium,n=s.halfScreenWidth-r.value.width*.5;super(e.getNewButtonPosition(new a(n,t.bottom),2.2),new g("main_menu_scene.button.play"),x.Default,r,()=>{this.removeClickListener(),this.action();}),this.gameMenuSceneManager=P.getInstance();}action(){this.gameMenuSceneManager.changeScene(new Di);}}const nt=class nt{constructor(t){const e=h.getInstance();this.title=new p(new g("score_placeholder_scene.text.records_not_found"),d.Highlighted,nt.FONT_SIZE_TITLE,new a(e.getMeasureByScreenWidth(.5),t.centerY)),this.description=new p(new g("score_placeholder_scene.text.recommendation"),d.Light,nt.FONT_SIZE_DESCRIPTION,new a(e.getMeasureByScreenWidth(.5),this.title.position.y+nt.GAP_CONTENT)),this.title.alignment="center",this.description.alignment="center";const r=-(this.title.height+this.description.height+nt.GAP_CONTENT)*.5;this.title.addOffset(a.Vertical(r)),this.description.addOffset(a.Vertical(r+this.description.height));}render(){this.title.render(),this.description.render();}};nt.GAP_CONTENT=12,nt.FONT_SIZE_TITLE=22,nt.FONT_SIZE_DESCRIPTION=16;let Ys=nt;const is=class is{};is.SHIP_ONE_MOVEMENT=Object.freeze({speed:10,speedTarget:0,deceleration:.0715}),is.SHIP_TWO_MOVEMENT=Object.freeze({speed:12,speedTarget:0,deceleration:.14});let be=is;class Qr{constructor(){const t=h.getInstance();this.shipOne=qt.OneShip(t.getPositionByScreen(.28,1.2),be.SHIP_ONE_MOVEMENT),this.shipTwo=qt.TwoShip(t.getPositionByScreen(.72,1.4),be.SHIP_TWO_MOVEMENT),this.ships=[this.shipOne,this.shipTwo];}get hasPassedScreen(){return this.ships.every(t=>t.hasPassedScreen);}update(){this.ships.forEach(t=>t.update());}render(){this.ships.forEach(t=>t.render());}}const rs=class rs{constructor(){this.backToMainMenuButton=C.BackToMainMenuButton(),this.overlayBackground=new ui(.35,rs.OVERLAY_BACKGROUND_HEIGHT),this.ships=new Qr,this.content=new Ys(this.overlayBackground);}update(){if(this.backToMainMenuButton.update(),!this.ships.hasPassedScreen){if(this.overlayBackground.expanded){this.ships.update();return;}this.overlayBackground.expand();}}render(){this.backToMainMenuButton.render(),this.overlayBackground.render(),this.content.render(),this.ships.render();}};rs.OVERLAY_BACKGROUND_HEIGHT=.28;let Vs=rs;const at=class at{constructor(t,e,s,r){this.startPosition=e,this.tableWidth=r,this.caption=new p(new g(t),d.Light,at.CAPTION_FONT_SIZE,e),this.headers=this.toHeaders(s,this.caption),this.adjustPosition();}render(){this.headers.forEach(t=>t.render()),this.caption.render();}adjustPosition(){this.adjustCaptionPosition();}toHeaders(t,e){const s=this.getHeaderWidth(t.length),r=(this.tableWidth-s*t.length)/t.length+1;let n=this.startPosition.x;const o=this.startPosition.y+e.height+at.HEAD_VERTICAL_GAP,l=[];return t.forEach(I=>{n+=r;const m=new p(new g(I),d.Light,at.HEADER_FONT_SIZE,new a(n,o));n+=s,l.push(m);}),l;}getHeaderWidth(t){return this.tableWidth/t*.8;}adjustCaptionPosition(){this.caption.addOffset(a.Horizontal(this.tableWidth*.5-this.caption.width*.5));}getCell(t){return this.headers[t];}get y(){return this.caption.position.y;}get bottom(){return this.caption.position.y+this.height;}get height(){const{caption:t,headers:e}=this,s=Math.max(...e.map(({height:r})=>r));return t.height+at.HEAD_VERTICAL_GAP+s;}addOffset(t){this.caption.addOffset(t),this.headers.forEach(e=>e.addOffset(t));}};at.CAPTION_FONT_SIZE=18,at.HEADER_FONT_SIZE=16,at.HEAD_VERTICAL_GAP=10;let bs=at;const ns=class ns{constructor(t,e,s,r,n,o){this.records=s,this.gap=o,this.head=new bs(t,r,e,n);}render(){this.head.render(),this.records.forEach(t=>t.render());}get height(){const t=this.records.reduce((e,{height:s})=>e+s+this.gap,0);return this.head.height+t;}get bottom(){return this.head.y+this.height;}addOffset(t){this.head.addOffset(t),this.records.forEach(e=>e.addOffset(t));}};ns.FONT_SIZE_CELL=16,ns.INDEX_RECORD_HORIZONTAL_GAP=20;let vt=ns;class Ti extends p{constructor(t){super(new R(t),d.LatestScore,vt.FONT_SIZE_CELL,a.Zero);}get right(){return this.position.x+this.width;}}class Bi{constructor(t,e){this.cells=[t,...e];}get height(){return Math.max(...this.cells.map(({height:t})=>t));}addOffset(t){this.cells.forEach(e=>e.addOffset(t));}getCell(t){return this.cells[t];}get indexCell(){return this.cells[0];}render(){this.cells.forEach(t=>t.render());}}class qr extends p{constructor(t,e){super(new R(`${t}.`),d.LatestScore,vt.FONT_SIZE_CELL,e);}get right(){return this.position.x+this.width;}}class Jr extends Bi{constructor(t,{points:e,date:s}){super(new qr(t,a.Zero),[new Ti(e),new Ti(s)]);}}class q extends p{constructor(t,e){super(new R(t),e,vt.FONT_SIZE_CELL,a.Zero);}static First(t){return new q(t,d.FirstScore);}static Second(t){return new q(t,d.SecondScore);}static Third(t){return new q(t,d.ThirdScore);}get right(){return this.position.x+this.width;}}class tn{constructor(t,e){this.spriteImage=new _({image:t,position:e});}get width(){return this.spriteImage.size.width;}get height(){return this.spriteImage.size.height;}get right(){return this.position.x+this.width;}get position(){return this.spriteImage.position;}addOffset(t){this.spriteImage.position=this.position.sum(t);}render(){this.spriteImage.render();}}const ot=class ot extends Bi{constructor(t,e,s){const r=new a(ot.INDEX_HORIZONTAL_OFFSET,ot.INDEX_VERTICAL_OFFSET);super(new tn(t,r),[e,s]);}static First({points:t,date:e}){return new ot(c.spriteManager.SCORE_MEDALS.first,q.First(t),q.First(e));}static Second({points:t,date:e}){return new ot(c.spriteManager.SCORE_MEDALS.second,q.Second(t),q.Second(e));}static Third({points:t,date:e}){return new ot(c.spriteManager.SCORE_MEDALS.third,q.Third(t),q.Third(e));}};ot.INDEX_HORIZONTAL_OFFSET=-4,ot.INDEX_VERTICAL_OFFSET=-10;let re=ot;const en={1:i=>re.First(i),2:i=>re.Second(i),3:i=>re.Third(i)},w=class w extends vt{constructor(t,e,s,r){super(t,w.SCORE_TABLE_HEADERS,e,s.sum(a.Horizontal(-w.TABLE_WIDTH*.5)),w.TABLE_WIDTH,r),this.adjustRecords(),this.adjustHeaders();}static TopScoreTable(t,e){return new w("score_records_scene.text.top_score",t,e,w.TOP_SCORE_RECORD_VERTICAL_GAP);}static LatestScoreTable(t,e){return new w("score_records_scene.text.latest_scores",t,e,w.LATEST_SCORE_RECORD_VERTICAL_GAP);}adjustHeaders(){const t=this.head.getCell(0),e=this.head.getCell(1),s=this.records[0],r=s.getCell(1),n=s.getCell(2);this.head.caption.addOffset(a.Horizontal(w.CAPTION_OFFSET_POSITION)),t.addOffset(a.Horizontal(s.indexCell.width+w.INDEX_RECORD_HORIZONTAL_GAP+r.width*.5-t.width*.5)),e.addOffset(a.Horizontal(n.width*.5-e.width*.5));}adjustRecords(){let t=this.head.bottom;const e=this.head.getCell(0),s=this.head.getCell(1);this.records.forEach(r=>{r===this.records[0]?t+=this.gap:t+=r.height+this.gap,r.addOffset(a.Vertical(t));const n=r.getCell(1),o=r.getCell(2);r.indexCell.addOffset(a.Horizontal(e.position.x)),n.addOffset(a.Horizontal(r.indexCell.right+vt.INDEX_RECORD_HORIZONTAL_GAP)),o.addOffset(a.Horizontal(s.position.x));});}};w.TABLE_WIDTH=500,w.CAPTION_OFFSET_POSITION=w.TABLE_WIDTH*.02,w.SCORE_TABLE_HEADERS=["score_records_scene.text.got","score_records_scene.text.when"],w.TOP_SCORE_RECORD_VERTICAL_GAP=14,w.LATEST_SCORE_RECORD_VERTICAL_GAP=18;let Ge=w;const pe=class pe{constructor(t){this.scoreService=Pe.getScoreService();const s=h.getInstance().halfScreenWidth;this.topScoreTable=Ge.TopScoreTable(this.getTopScores(),new a(s,t.centerY)),this.latestScoreTable=Ge.LatestScoreTable(this.getLatestScores(),new a(s,pe.GAP+this.topScoreTable.bottom));const r=a.Vertical((this.topScoreTable.height+pe.GAP+this.latestScoreTable.height)*-.5);this.topScoreTable.addOffset(r),this.latestScoreTable.addOffset(r);}getTopScores(){return this.scoreService.getTopScores().map(e=>this.formatScore(e)).map((e,s)=>en[s+1](e));}getLatestScores(){return this.scoreService.getLatestScores().map(e=>this.formatScore(e)).map((e,s)=>new Jr(s+1,e));}formatScore(t){return{points:`${Ce.getScoreFormat(t.points)} pts`,date:`${t.date} | ${t.time}`};}render(){this.topScoreTable.render(),this.latestScoreTable.render();}};pe.GAP=20;let Gs=pe;const as=class as{constructor(){this.backToMainMenuButton=C.BackToMainMenuButton(),this.overlayBackground=new ui(.17,as.OVERLAY_BACKGROUND_HEIGHT),this.scoreTableGroup=new Gs(this.overlayBackground);}update(){this.backToMainMenuButton.update(),this.overlayBackground.expand();}render(){this.backToMainMenuButton.render(),this.overlayBackground.render(),this.scoreTableGroup.render();}};as.OVERLAY_BACKGROUND_HEIGHT=.7;let Ws=as;class sn extends U{constructor(t,e){super(e.getNewButtonPosition(new a(t.x,t.bottom)),new g("main_menu_scene.button.score"),x.Default,H.Medium,()=>{this.removeClickListener(),this.action();}),this.scoreService=Pe.getScoreService(),this.gameMenuSceneManager=P.getInstance();}action(){const t=this.scoreService.existScoreRecords()?new Ws:new Vs;this.gameMenuSceneManager.changeScene(t);}}const os=class os{constructor(t){const e=new $r(t,this),s=new sn(e,this),r=new zr(s,this),n=new jr(r,this);this.buttons=[e,s,r,n];}getNewButtonPosition(t,e){return new a(t.x,t.y+os.VERTICAL_MARGIN*(e||1));}update(){this.buttons.forEach(t=>t.update());}render(){this.buttons.forEach(t=>t.render());}};os.VERTICAL_MARGIN=22;let zs=os;class gi extends ci{constructor(t,e){super(e),this.spriteImage=new _({image:t,position:e});}render(){this.spriteImage.render();}get width(){return this.spriteImage.size.width;}get height(){return this.spriteImage.size.height;}}class Hi{constructor(t,e){this.interval=t,this.speed=e,this.switchDirection=1,this.direction=z.Backward,this.line=0,this.counter=0;}update(){this.calculateSway();}render(){this.renderSway();}calculateSway(){this.addValueToDimension(this.line),this.updateCounter();}updateCounter(){this.line=this.speed*this.direction,this.counter++,this.counter===this.interval&&(this.toggleDirection(),this.counter=0);}toggleDirection(){this.direction*=-1*this.switchDirection,this.switchDirection*=-1;}}class rn extends Hi{constructor(t,e,s){super(e,s),this.visualElement=t;}renderSway(){this.visualElement.render();}addValueToDimension(t){this.visualElement.position.y+=t;}}const Wt=class Wt{constructor(t){this.mainMenuTitle=t,this.spriteImage=new _({image:c.spriteManager.WEB_EDITION_TAG,position:a.Zero,degrees:Wt.DEGREES});}calculatePosition(){const t=this.mainMenuTitle.right-this.spriteImage.size.width*.5-this.mainMenuTitle.width*.14,e=this.mainMenuTitle.y+this.mainMenuTitle.height+Wt.GAP;return new a(t,e);}get height(){return this.spriteImage.size.height;}get axisOfRotation(){return new a(-this.spriteImage.size.width*.5,-this.spriteImage.size.height*.5);}update(){this.spriteImage.position=this.calculatePosition();}render(){this.spriteImage.render();}};Wt.GAP=20,Wt.DEGREES=-20;let Us=Wt;class nn{constructor(){this.TITLE_SWAY_INTERVAL=20,this.TITLE_SWAY_SPEED=.5;const t=new _({image:c.spriteManager.TITLE,position:a.Zero});t.position=this.calculatePosition(t),this.spriteImage=t,this.swayEffect=new rn(new gi(this.spriteImage.image,this.spriteImage.position),this.TITLE_SWAY_INTERVAL,this.TITLE_SWAY_SPEED),this.mainMenuWebEditionTag=new Us(this);}calculatePosition(t){const e=h.getInstance();return new a(e.halfScreenWidth-t.size.width*.5,e.getMeasureByScreenHeight(.1));}get bottom(){return this.spriteImage.position.y+this.spriteImage.size.height+this.mainMenuWebEditionTag.height;}get right(){return this.spriteImage.position.x+this.spriteImage.size.width;}get width(){return this.spriteImage.size.width;}get y(){return this.spriteImage.position.y;}get height(){return this.spriteImage.size.height;}update(){this.swayEffect.update(),this.mainMenuWebEditionTag.update();}render(){this.spriteImage.render(),this.swayEffect.render(),this.mainMenuWebEditionTag.render();}}class wi{constructor(t,e,s,r){this.renderer=h.getInstance().renderer,this.spriteImage=new _({image:e.sprites.arrow,position:t}),this.spriteImage.scale(s.scale),this.mouseAdapter=new te(t,this.spriteImage.size,()=>r(this)),this.opacity=1;}get bottom(){return this.spriteImage.position.y+this.spriteImage.size.height;}get right(){return this.spriteImage.position.x+this.spriteImage.size.width;}get y(){return this.spriteImage.position.y;}get size(){return this.spriteImage.size;}removeClickListener(){this.mouseAdapter.removeClickListener();}addOffset(t){this.spriteImage.position.x+=t.x,this.spriteImage.position.y+=t.y;}update(){this.mouseAdapter.update(),this.opacity=this.mouseAdapter.isHover?1:.5;}render(){this.renderer.setOpacity(this.opacity,()=>{this.spriteImage.render();});}}const hs=class hs{constructor(t,e){this._lang=e,this.flagSprites=c.spriteManager.FLAGS,this.spriteImage=new _({image:this.flagSprites.getFlag(e),position:t}),this.spriteImage.scale(hs.SCALE),this.gameLanguageManager=tt.getInstance();}get right(){return this.spriteImage.position.x+this.spriteImage.size.width;}get y(){return this.spriteImage.position.y;}get size(){return this.spriteImage.size;}get totalFlags(){return this.flagSprites.getQuantityFlags();}get lang(){return this._lang;}addOffset(t){this.spriteImage.position=this.spriteImage.position.sum(t);}change(t){this.spriteImage.image=this.flagSprites.getFlag(t),this.gameLanguageManager.setLanguage(t),this._lang=t;}render(){this.spriteImage.render();}};hs.SCALE=1;let Ks=hs;class we{constructor(t){this.sprites=t;}static get Left(){return new we(c.spriteManager.LEFT_ARROW);}static get Right(){return new we(c.spriteManager.RIGHT_ARROW);}}class Oe{constructor(t){this.scale=t;}static get Small(){return new Oe(.7);}static get Medium(){return new Oe(1);}}const yt=class yt{constructor(t){const e=yt.BackFlagButton(t,this);this.languageFlag=yt.Flag(e);const s=yt.NextFlagButton(this.languageFlag,this);this.navigateButtons=[e,s],this.adjustPosition(e,s),this.langIndex=Zt.indexOf(this.languageFlag.lang);}static BackFlagButton(t,e){return new wi(t,we.Left,Oe.Small,()=>e.navigate(z.Backward));}static Flag(t){return new Ks(new a(t.right+this.HORIZONTAL_GAP,t.y),tt.getInstance().lang);}static NextFlagButton(t,e){return new wi(new a(t.right+this.HORIZONTAL_GAP,t.y),we.Right,Oe.Small,()=>e.navigate(z.Forward));}navigate(t){this.langIndex=(this.langIndex-t+this.languageFlag.totalFlags)%this.languageFlag.totalFlags,this.languageFlag.change(Zt[this.langIndex]);}adjustPosition(t,e){const s=[t.size,e.size,this.languageFlag.size],r=Math.max(...s.map(l=>l.height)),n=[...s.map(l=>l.width),yt.HORIZONTAL_GAP*s.length-1].reduce((l,I)=>l+I,0);this.languageFlag.addOffset(a.Vertical(r*.5-this.languageFlag.size.height*.5));const o=new a(-n,-r);this.languageFlag.addOffset(o),this.navigateButtons.forEach(l=>{l.addOffset(o);});}update(){this.navigateButtons.forEach(t=>t.update());}render(){this.navigateButtons.forEach(t=>t.render()),this.languageFlag.render();}};yt.HORIZONTAL_GAP=18;let Zs=yt;class ki{constructor(){this.mainMenuTitle=new nn,this.mainMenuButtonController=new zs(this.mainMenuTitle);const t=h.getInstance();this.mainLangSelectorController=new Zs(t.getPositionByScreen(.95,.89));}update(){this.mainMenuTitle.update(),this.mainMenuButtonController.update(),this.mainLangSelectorController.update();}render(){this.mainMenuTitle.render(),this.mainMenuButtonController.render(),this.mainLangSelectorController.render();}}class an{constructor(){const t=c.spriteManager.VOLUME_ICON;this.values=[{sprite:t[0],level:mt.Mute},{sprite:t[1],level:mt.Low},{sprite:t[2],level:mt.Medium},{sprite:t[3],level:mt.High}];}}const on=Ct(class extends wt{constructor(){const t=ai(),e=new an,s=e.values.findIndex(({level:r})=>t.level===r);super(a.Zero,e.values[s].sprite,.3),this.audioVolumeLevelMapping=e,this.opacity=1,this.mouseAdapter=new te(this.position,new M(this.width,this.height),()=>this.navigateLevel()),this.audioVolumeLevelManager=t,this.iconIndex=s;}navigateLevel(){this.updateIconIndex();const{sprite:t,level:e}=this.audioVolumeLevelMapping.values[this.iconIndex];this._spriteImage.image=t,this.audioVolumeLevelManager.change(e);}updateIconIndex(){const t=this.iconIndex>=this.audioVolumeLevelMapping.values.length-1;this.iconIndex=t?0:this.iconIndex+1;}fillOpacity(){this.opacity=this.mouseAdapter.isHover?1:.5;}update(){this.mouseAdapter.update(),this.fillOpacity();}render(){this.renderProvider.renderer.setOpacity(this.opacity,()=>{this._spriteImage.render();});}}),Yi=on;class pi{constructor(){const t=ye();t.change(vi.Menu),t.currentTrack.play(),this.background=new De(u.GAME_MENU_SCENE_BACKGROUND_SPEED),this.gameMenuSceneManager=P.getInstance();const e=Wi().custom.getInitialMenuScene(()=>new ki);this.gameMenuSceneManager.changeScene(e),this.audioVolumeLevelButton=Yi();}update(){this.background.update(),this.gameMenuSceneManager.update(),this.audioVolumeLevelButton.update();}render(){this.background.render(),this.gameMenuSceneManager.render(),this.audioVolumeLevelButton.render();}}class hn{constructor(){this.renderProvider=h.getInstance(),this.gameControlProvider=J.getInstance(),this.globalSceneManager=B.getInstance(),this.hasPulsedExitButtonForFirstTime=!1,this.gameExitMessage=new Ms(new a(this.renderProvider.halfScreenWidth,this.renderProvider.halfScreenHeight)),this._wantToExit=!1,this.waitTimer=new N(()=>this.resetExitStatus(),2e3);}render(){this._wantToExit&&this.gameExitMessage.render();}update(){this.checkExit(),this._wantToExit&&this.waitTimer.update();}get wantToExit(){return this._wantToExit;}hasPulseExitButton(){return this.gameControlProvider.hasPulsed(f.Exit);}checkExit(){this.hasPulseExitButton()&&this.hasPulsedExitButtonForFirstTime?(this.hasPulsedExitButtonForFirstTime=!1,this.checkExitStatus()):!this.hasPulseExitButton()&&!this.hasPulsedExitButtonForFirstTime&&(this.hasPulsedExitButtonForFirstTime=!0);}checkExitStatus(){if(this._wantToExit){this.globalSceneManager.changeScene(new pi);return;}this._wantToExit=!0,this.waitTimer.start();}resetExitStatus(){this._wantToExit=!1,this.waitTimer.stop();}}class cn{constructor(){const t=h.getInstance();this.rectangle=new us(a.Vertical(t.getMeasureByScreenHeight(L.POSITION_Y_BY_SCREEN)),new M(t.canvasSize.width,t.getMeasureByScreenHeight(L.HEIGHT_BY_SCREEN)),d.Overlay);}render(){this.rectangle.render();}}class Ei extends ci{constructor(){super(a.Zero),this.renderProvider=h.getInstance(),this.rectangle=new us(this.position,this.renderProvider.canvasSize);}render(){this.rectangle.render();}get height(){return this.renderProvider.canvasSize.height;}get width(){return this.renderProvider.canvasSize.width;}}class Vi{constructor(t,e){this.visualElement=t,this.renderProvider=h.getInstance(),this.opacityRatio=e,this.opacity=0;}update(){this.calculateOpacity();}render(){this.renderFade();}renderFade(){this.renderProvider.renderer.setOpacity(this.opacity,()=>this.visualElement.render());}hasReachOpacity(t){return this.opacity>=t;}}class dn extends Vi{constructor(t,e){super(t,e),this.opacity=1;}calculateOpacity(){this.opacity-=this.opacityRatio,this.opacity<=0&&(this.opacity=0);}get isFinished(){return this.opacity<=0;}}class ln{constructor(t){this.gameOverController=t;}update(){this.gameOverController.update();}render(){this.gameOverController.render();}}class Oi{constructor(t){this.gamePauseController=t;}render(){this.gamePauseController.render();}update(){this.gamePauseController.update();}}class We extends Vi{constructor(t,e){super(t,e);}calculateOpacity(){this.opacity+=this.opacityRatio,this.opacity>=1&&(this.opacity=1);}get isFinished(){return this.opacity>=1;}}const zt=class zt{constructor(t){this.gameManager=t,this.screenFadeInEffect=new We(new Ei,zt.SCREEN_FADE_IN_EFFECT_SCREEN_OPACITY_INCREMENT),this.timer=new N(()=>this.gameManager.nextGame(),zt.TIMEOUT_FOR_START_CONTINUATION_OF_THE_GAME);}update(){this.screenFadeInEffect.isFinished?this.timer.isStopped?this.timer.start():this.timer.update():this.screenFadeInEffect.update();}render(){this.screenFadeInEffect.render();}};zt.SCREEN_FADE_IN_EFFECT_SCREEN_OPACITY_INCREMENT=.02,zt.TIMEOUT_FOR_START_CONTINUATION_OF_THE_GAME=1e3;let Xs=zt;class un{constructor(t){this.newGameManager=new Xs(t);}render(){this.newGameManager.render();}update(){this.newGameManager.update();}}const $=class ${constructor(t,e){this.gameScene=t,this.globalSceneManager=B.getInstance(),this.scoreService=Pe.getScoreService(),this._score=e,this._highScore=this.getHighScore(this._score),this.winStateOfGameManager=new un(this),this.defeatStateOfGameManager=new ln(t.gameOverController),this.playingStateOfGameManager=new Oi(t.gamePauseController),this.currentStateOfGameManager=this.playingStateOfGameManager,this.screenFadeOutEffect=new dn(new Ei,$.SCREEN_FADE_OUT_EFFECT_SCREEN_OPACITY_INCREMENT);}static getScoreFormat(t){return t.toString().padStart($.MAX_FIGURE_SCORE,$.DEFAULT_DIGIT);}static getDefaultScoreFormat(){return $.DEFAULT_DIGIT.repeat($.MAX_FIGURE_SCORE);}get score(){return this._score;}get highScore(){return this._highScore;}get isFinished(){return this.screenFadeOutEffect.isFinished;}getHighScore(t){const e=this.scoreService.getHighScore();return t>e?t:e;}update(){this.screenFadeOutEffect.isFinished||this.screenFadeOutEffect.update(),this.currentStateOfGameManager=this.getCurrentStateOfGameManager(),this.currentStateOfGameManager.update();}render(){this.screenFadeOutEffect.render(),this.currentStateOfGameManager.render();}getCurrentStateOfGameManager(){return this.gameScene.enemyHord.noEnemies?this.winStateOfGameManager:this.gameScene.playerManager.noPlayers?this.defeatStateOfGameManager:this.playingStateOfGameManager;}syncHighScoreIfIsReached(){this._score>this.highScore&&(this._highScore=this._score);}incrementScore(t){this._score+=t.points,this.syncHighScoreIfIsReached();}saveScore(){if(this._score===0)return;const t=new Ps(this._score);this.scoreService.saveScore(t);}isPlaying(){return this.currentStateOfGameManager instanceof Oi;}nextGame(){this.globalSceneManager.changeScene(Tt.NextGame(this));}};$.MAX_FIGURE_SCORE=7,$.DEFAULT_DIGIT="0",$.SCREEN_FADE_OUT_EFFECT_SCREEN_OPACITY_INCREMENT=.03;let _e=$;class gn{constructor(t,e){this.gameManager=e;const s=h.getInstance(),r=new a(s.halfScreenWidth,t.getCenterY());this.value=new p(new R(this.highScoreIndicator),d.Highlighted,L.FONT_SIZE,r.copy()),this.label=new p(new g("game_scene.text.score"),d.Light,L.FONT_SIZE,r.copy()),this.value.addOffset(a.Horizontal(L.GAP_COMPONENT*.5)),this.label.addOffset(a.Horizontal(-L.GAP_COMPONENT*.5-this.label.width));}get highScoreIndicator(){return _e.getScoreFormat(this.gameManager.score);}update(){this.value.content.setValue(this.highScoreIndicator);}render(){this.label.render(),this.value.render();}}const ht=class ht{constructor(t,e){this.player=t,this.renderProvider=h.getInstance(),this.opacity=1;const s=this.calculateSize();this.spriteImage=new _({image:this.player.sprite,position:e.diff(a.Vertical(s.height*.5)),size:s});}get width(){return this.spriteImage.size.width;}calculateSize(){const{width:t,height:e}=this.player.sprite;return new M(t*ht.SCALE,e*ht.SCALE);}update(){this.opacity=this.player.isDead?ht.DEAD_PLAYER_OPACITY:ht.LIVE_PLAYER_OPACITY;}render(){this.renderProvider.renderer.setOpacity(this.opacity,()=>{this.spriteImage.render();});}};ht.SCALE=.8,ht.LIVE_PLAYER_OPACITY=1,ht.DEAD_PLAYER_OPACITY=.25;let js=ht;const Ee=class Ee{constructor(t,e){this.player=t,this.playerSprite=new js(this.player,e),this.lifeText=new p(new R(this.lifeCounter),d.Light,L.FONT_SIZE,e),this.lifeText.addOffset(a.Horizontal(this.playerSprite.width+Ee.GAP));}update(){this.playerSprite.update(),this.lifeText.content.setValue(this.lifeCounter);}render(){this.playerSprite.render(),this.lifeText.render();}get width(){return this.playerSprite.width+Ee.GAP+this.lifeText.width;}get lifeCounter(){return`x${this.player.lifes}`;}};Ee.GAP=10;let $s=Ee;const cs=class cs{constructor(t,e){this.gameHudPlayerLifes=new Map;const s=h.getInstance(),r=e.getCenterY();let n=s.getMeasureByScreenWidth(L.HORIZONTAL_PADDING);t.forEachPlayer(o=>{const l=new $s(o,new a(n,r));this.gameHudPlayerLifes.set(o.id,l),n+=l.width+cs.GAP;});}update(){this.gameHudPlayerLifes.forEach(t=>t.update());}render(){this.gameHudPlayerLifes.forEach(t=>t.render());}};cs.GAP=35;let Qs=cs;class pn{constructor(t,e){this.gameManager=e;const{canvasSize:s}=h.getInstance(),r=s.width-t.getHorizontalPadding(),n=new a(r,t.getCenterY());this.value=new p(new R(this.scoreIndicator),d.Highlighted,L.FONT_SIZE,n.copy()),this.label=new p(new g("game_scene.text.highest_score"),d.Light,L.FONT_SIZE,n.copy()),this.value.addOffset(a.Horizontal(-this.value.width)),this.label.addOffset(a.Horizontal(-this.value.width-this.label.width-L.GAP_COMPONENT));}get scoreIndicator(){return _e.getScoreFormat(this.gameManager.highScore);}update(){this.value.content.setValue(this.scoreIndicator);}render(){this.value.content.setValue(this.scoreIndicator),this.label.render(),this.value.render();}}const Q=class Q{constructor(t,e){this.renderProvider=h.getInstance(),this.hudBackground=new cn,this.hudPlayerLifes=new Qs(t,this),this.hudScore=new gn(this,e),this.hudHighScore=new pn(this,e);}update(){this.hudPlayerLifes.update(),this.hudScore.update(),this.hudHighScore.update();}render(){this.hudBackground.render(),this.hudPlayerLifes.render(),this.hudScore.render(),this.hudHighScore.render();}getHorizontalPadding(){return this.renderProvider.getMeasureByScreenWidth(Q.HORIZONTAL_PADDING);}getCenterY(){const{renderProvider:t}=this;return t.getMeasureByScreenHeight(Q.POSITION_Y_BY_SCREEN)+t.getMeasureByScreenHeight(Q.HEIGHT_BY_SCREEN/2);}};Q.HEIGHT_BY_SCREEN=.12,Q.POSITION_Y_BY_SCREEN=.88,Q.HORIZONTAL_PADDING=.05,Q.FONT_SIZE=18,Q.GAP_COMPONENT=20;let L=Q;class bi extends Hi{constructor(t,e,s){super(e,s),this.visualElement=t;}renderSway(){this.visualElement.render();}addValueToDimension(t){this.visualElement.position.x+=t;}}const v=class v{constructor(){this.renderProvider=h.getInstance();const t=c.spriteManager.GAME_OVER,e=this.renderProvider.getCenterPosition(new M(t.width,t.height));this.screenFadeInEffect=new We(new Ei,v.GAME_OVER_SCREEN_OPACITY_INCREMENT),this.gameOverSpriteFadeInEffect=new We(new gi(t,e),v.GAME_OVER_FADE_INTERVAL),this.backToMainMenuMessageSwayEffect=v.BackToMainMenuMessageSwayEffect(this.renderProvider);}get isMounted(){return this.screenFadeInEffect.isFinished;}static BackToMainMenuMessageSwayEffect(t){const e=new p(new g("game_scene.text.game_over"),d.Light,v.GAME_OVER_FONT_SIZE,t.getPositionByScreen(.5,.8));return e.addOffset(a.Horizontal(-e.width*.5)),new bi(new di(e),v.GAME_OVER_SWAY_INTERVAL,v.GAME_OVER_SWAY_SPEED);}update(){this.screenFadeInEffect.update(),this.screenFadeInEffect.hasReachOpacity(.5)&&this.gameOverSpriteFadeInEffect.update(),this.screenFadeInEffect.isFinished&&this.backToMainMenuMessageSwayEffect.update();}render(){this.screenFadeInEffect.render(),this.gameOverSpriteFadeInEffect.render(),this.screenFadeInEffect.isFinished&&this.backToMainMenuMessageSwayEffect.render();}};v.GAME_OVER_SCREEN_OPACITY_INCREMENT=.02,v.GAME_OVER_FADE_INTERVAL=.01,v.GAME_OVER_SWAY_INTERVAL=20,v.GAME_OVER_SWAY_SPEED=.3,v.GAME_OVER_FONT_SIZE=20;let qs=v;class En{constructor(){this.gameOverScreen=new qs,this.gameControlProvider=J.getInstance(),this.globalSceneManager=B.getInstance(),this.soundtrackManager=ye(),this.hasPulsedStartButtonForFirstTime=!1;}hasPulsedStartButton(){const t=this.gameControlProvider.hasPulsed(f.Enter);return t&&!this.hasPulsedStartButtonForFirstTime&&(this.hasPulsedStartButtonForFirstTime=!0),!t&&this.hasPulsedStartButtonForFirstTime;}muteSoundtrack(){const{currentTrack:t}=this.soundtrackManager;t.audioComponent.isStopped||(t.changeVolume(Xt.Muted),t.stop());}get isGameOver(){return this.gameOverScreen.isMounted;}update(){this.gameOverScreen.update(),this.isGameOver&&this.muteSoundtrack(),this.hasPulsedStartButton()&&this.globalSceneManager.changeScene(new pi);}render(){this.gameOverScreen.render();}}class mn{constructor(t,e,s,r){this.enemyHord=t,this.shieldLine=e,this.playerManager=s,this.gameManager=r,this.explosionEffectManager=D.getInstance();}isInArea(t,e){return t.position.y+t.height>=e.position.y;}checkPlayerContact(t,e){e.isDead||!this.isInArea(t,e)||(e.kill(),this.explosionEffectManager.play(e),this.playerManager.noPlayers&&this.gameManager.saveScore());}checkShieldContact(t,e){e.isDestroyed||!this.isInArea(t,e)||(e.smash(),this.explosionEffectManager.play(e),this.shieldLine.destroy(e));}update(){this.enemyHord.forEachEnemy(t=>{this.playerManager.forEachPlayer(e=>this.checkPlayerContact(t,e)),this.shieldLine.forEachShield(e=>this.checkShieldContact(t,e));});}}class Tt{constructor(t,e){this.playerManager=t;const s=ye();s.change(vi.Game),s.currentTrack.play(),this.background=new De(u.GAME_SCENE_BACKGROUND_SPEED),this.enemyHord=new gr(t.enemyHordQuantityRows),this.shieldLine=new hi,this.explosionEffectManager=D.getInstance(),this.shieldCollisionManager=new mr(this.shieldLine),this.gamePauseController=new Tr,this.gameOverController=new En,this.gameManager=new _e(this,e||0),this.enemyCollisionManager=new Ir(this.enemyHord,this.gameManager),this.playerCollisionManager=new Sr(this.playerManager,this.gameManager),this.laserController=Ot.getInstance(),this.gameHud=new L(this.playerManager,this.gameManager),this.gameExitController=new hn,this.destructionByEnemyHordContact=new mn(this.enemyHord,this.shieldLine,this.playerManager,this.gameManager),this.audioVolumeLevelButton=Yi();}static Initial(t){return new Tt(t);}static NextGame(t){const e=t.gameScene.playerManager;return e.forEachPlayer(s=>{s.resetPosition(),s.incrementLifes();}),new Tt(e,t.score);}update(){if(this.gameManager.update(),this.gameOverController.isGameOver||this.audioVolumeLevelButton.update(),this.gameOverController.isGameOver||this.gamePauseController.isPaused){this.gameExitController.resetExitStatus();return;}this.background.update(),this.playerManager.update(),this.enemyHord.update(),this.shieldLine.update(),this.explosionEffectManager.update(),this.shieldCollisionManager.update(),this.enemyCollisionManager.update(),this.playerCollisionManager.update(),this.destructionByEnemyHordContact.update(),this.laserController.update(),this.gameExitController.update(),this.gameHud.update();}render(){this.background.render(),this.playerManager.render(),this.enemyHord.render(),this.shieldLine.render(),this.explosionEffectManager.render(),this.laserController.render(),this.gameHud.render(),this.gameManager.render(),this.gameExitController.render(),this.gameOverController.isGameOver||this.audioVolumeLevelButton.render();}}class gs{constructor(t){this.custom=t;}init(){this.withChangeLang(),this.withChangeVolumeLevel();}withChangeLang(){const{translationManager:t}=tt.getInstance();window.changeLang=e=>t.change(e);}withChangeVolumeLevel(){const t=ai();window.changeVolumeLevel=e=>t.change(e);}}function ps(i,t){const{DEV:e}={VITE_ROOT_DIRECTORY:"/invasores_p_web_sandbox",VITE_BUILD_DIRECTORY:"./invasores_p_web_sandbox/build",BASE_URL:"/invasores_p_web_sandbox",MODE:"sandbox",DEV:!1,PROD:!0,SSR:!1};return e?t():i();}const Gi="default",_i=new Map(Object.entries({manuel:new gs({getInitialMenuScene:i=>ps(i,()=>new li),getInitialGlobalScene:i=>ps(i,()=>Tt.Initial(Nt.Individual()))}),ausubel:new gs({getInitialMenuScene:i=>ps(i,()=>Tt.Initial(Nt.Multiplayer({playerOne:"ANUEL",playerTwo:"Auschberg"}))),getInitialGlobalScene:i=>i()}),[Gi]:new gs({getInitialMenuScene:i=>i(),getInitialGlobalScene:i=>i()})}));function Wi(){return _i.get({}.VITE_DEBUGGING_SET)||_i.get(Gi);}const G=class G{constructor(t){this.game=t,this.fps=0,this.frames=0,this.nowTime=performance.now(),this.lastTime=0,this.elapsedTime=0,this.renderProvider=h.getInstance(),this.textContent=new p(new R(`FPS: ${this.fps}`),d.FPS,G.FONT_SIZE,this.renderProvider.getPositionByScreen(.94,.05));}count(){this.nowTime=performance.now(),this.elapsedTime+=this.nowTime-this.lastTime,this.lastTime=this.nowTime,this.elapsedTime>=G.FRAME_PER_MILLIS&&(this.game.update(),this.game.render(),this.displayFps(),this.frames++,this.elapsedTime=0),this.frames>=G.FPS&&(this.fps=this.frames,this.frames=0);}displayFps(){const{textContent:t,fps:e}=this;t.content.setValue(`FPS: ${e}`),t.render();}};G.MILLIS_PER_SECOND=1e3,G.FPS=90,G.FRAME_PER_MILLIS=G.MILLIS_PER_SECOND/G.FPS,G.FONT_SIZE=14;let Js=G;class In{constructor(t,e){this.sprites=e;const s=B.getInstance();this.spriteImage=new _({image:e.base,position:t}),this.mouseAdapter=new te(t,this.spriteImage.size,r=>{r.removeClickListener(),s.changeScene(Wi().custom.getInitialGlobalScene(()=>new pi));});}get position(){return this.spriteImage.position;}update(){this.mouseAdapter.update(),this.spriteImage.image=this.mouseAdapter.isHover?this.sprites.hover:this.sprites.base;}render(){this.spriteImage.render();}}const A=class A{constructor(){this.renderProvider=h.getInstance(),this.background=new Ci(d.Dark),this.sprites=c.spriteManager.SPLASH_LOGO;const t=this.sprites.base,e=A.BasePosition(this.renderProvider,t);this.splashSpriteFadeInEffect=new We(new gi(t,e),A.SPLASH_FADE_INTERVAL_INTERVAL),this.splashStartGameButton=new In(e,this.sprites);const s=A.GoToMenuMessage(this.splashStartGameButton,this.sprites);this.centerAllComponents(e,s),this.goToMenuMessageSwayEffect=new bi(new di(s),A.SPLASH_TEXT_INTERVAL,A.SPLASH_TEXT_SPEED);}update(){this.splashSpriteFadeInEffect.isFinished?this.splashStartGameButton.update():this.splashSpriteFadeInEffect.update(),this.goToMenuMessageSwayEffect.update();}render(){this.background.render(),this.splashSpriteFadeInEffect.render(),this.splashSpriteFadeInEffect.isFinished?this.splashStartGameButton.render():this.splashSpriteFadeInEffect.render(),this.goToMenuMessageSwayEffect.render();}centerAllComponents(t,e){const s=this.renderProvider.halfScreenHeight-this.calculateTotalHeight(e)*.5;t.y+=s,e.addOffset(a.Vertical(s));}calculateTotalHeight(t){return this.sprites.base.height+A.SPLASH_TEXT_GAP+t.height;}static GoToMenuMessage(t,e){const s=e.base,r=new p(new g("splash_scene.text.start"),d.Light,A.SPLASH_TEXT_FONT_SIZE,t.position);return r.addOffset(new a(-r.width*.5+s.width*.5,s.height+A.SPLASH_TEXT_GAP)),r;}static BasePosition(t,e){return new a(t.halfScreenWidth-e.width*.5,0);}};A.SPLASH_FADE_INTERVAL_INTERVAL=.05,A.SPLASH_TEXT_FONT_SIZE=20,A.SPLASH_TEXT_SPEED=.5,A.SPLASH_TEXT_INTERVAL=10,A.SPLASH_TEXT_GAP=40;let ti=A;class Sn{constructor(){this.renderProvider=h.getInstance(),this.cursorMouseManager=Lt.getInstance(),this.fpsController=new Js(this),this.globalSceneManager=B.getInstance(),this.globalSceneManager.changeScene(new ti),this.soundtrackManager=ye(),this.sfxBuilder=dt();}update(){this.globalSceneManager.update(),this.cursorMouseManager.update(),this.sfxBuilder.update(),this.soundtrackManager.hasTrack&&this.soundtrackManager.currentTrack.update();}render(){this.renderProvider.clearScreen(),this.globalSceneManager.render();}runLoop(){requestAnimationFrame(()=>{this.fpsController.count(),this.runLoop();});}init(){this.runLoop();}}class fn{static async init(){await Promise.all(Object.values(si).map(t=>this.loadFont(t)));}static loadFont(t){return new Promise(e=>{const s=new FontFace(t,`url(${ds(`fonts/${t}.ttf`)})`);document.fonts.add(s),s.load().then(()=>e());});}}async function Tn(){await c.init(),await fn.init(),await Ns().init(),await dt().init(),await tt.init();}async function wn(){await Tn(),new Sn().init();}window.addEventListener("DOMContentLoaded",()=>{wn();});
